<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Backend Mentor - Code Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/monaco-editor@0.44.0/min/vs/loader.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              dark: {
                50: "#f8fafc",
                100: "#f1f5f9",
                200: "#e2e8f0",
                300: "#cbd5e1",
                400: "#94a3b8",
                500: "#64748b",
                600: "#475569",
                700: "#334155",
                800: "#1e293b",
                900: "#0f172a",
                950: "#020617",
              },
            },
          },
        },
      };
    </script>
    <style>
      :root {
        --bg-primary: #020617;
        --bg-secondary: #0f172a;
        --bg-tertiary: #1e293b;
        --text-primary: #f8fafc;
        --text-secondary: #cbd5e1;
        --accent-blue: #3b82f6;
        --accent-purple: #a855f7;
        --accent-green: #10b981;
        --accent-red: #ef4444;
        --accent-yellow: #f59e0b;
      }

      [data-theme="light"] {
        --bg-primary: #ffffff;
        --bg-secondary: #f8fafc;
        --bg-tertiary: #f1f5f9;
        --text-primary: #0f172a;
        --text-secondary: #475569;
      }

      [data-theme="high-contrast"] {
        --bg-primary: #000000;
        --bg-secondary: #1a1a1a;
        --bg-tertiary: #333333;
        --text-primary: #ffffff;
        --text-secondary: #cccccc;
      }

      body {
        font-family: "Inter", sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        height: 100vh;
        max-height: 100vh;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .glass-effect {
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(59, 130, 246, 0.2);
      }

      .sidebar {
        background: var(--bg-secondary);
        border-right: 1px solid rgba(59, 130, 246, 0.2);
        transition: all 0.3s ease;
      }

      .tab-active {
        background: rgba(59, 130, 246, 0.2);
        border-bottom: 2px solid var(--accent-blue);
      }

      .file-tree-item {
        transition: all 0.2s ease;
        cursor: pointer;
      }

      .file-tree-item:hover {
        background: rgba(59, 130, 246, 0.1);
      }

      .file-tree-item.active {
        background: rgba(59, 130, 246, 0.2);
      }

      .terminal {
        background: #0a0a0a;
        font-family: "JetBrains Mono", monospace;
        color: #00ff00;
        overflow-y: auto;
      }

      .terminal-input {
        background: transparent;
        border: none;
        outline: none;
        color: #00ff00;
        font-family: "JetBrains Mono", monospace;
        flex: 1;
      }

      .status-bar {
        background: #007acc;
        color: white;
        font-size: 12px;
      }

      .ai-panel {
        background: linear-gradient(
          135deg,
          rgba(168, 85, 247, 0.1) 0%,
          rgba(59, 130, 246, 0.1) 100%
        );
        border: 1px solid rgba(168, 85, 247, 0.3);
        max-height: 500px;
      }

      .settings-panel {
        background: var(--bg-secondary);
        border: 1px solid rgba(59, 130, 246, 0.2);
      }

      .test-passed {
        color: var(--accent-green);
      }
      .test-failed {
        color: var(--accent-red);
      }
      .test-pending {
        color: var(--accent-yellow);
      }

      .api-method-get {
        background: var(--accent-green);
      }
      .api-method-post {
        background: var(--accent-blue);
      }
      .api-method-put {
        background: var(--accent-yellow);
      }
      .api-method-delete {
        background: var(--accent-red);
      }

      .resizer {
        background: rgba(59, 130, 246, 0.2);
        cursor: col-resize;
        transition: background 0.2s ease;
      }

      .resizer:hover {
        background: rgba(59, 130, 246, 0.4);
      }

      .notification {
        animation: slideIn 0.3s ease-out;
        z-index: 1000;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
        }
        to {
          transform: translateX(0);
        }
      }

      .code-highlight {
        background: rgba(59, 130, 246, 0.2);
        border-left: 3px solid var(--accent-blue);
      }

      .ai-suggestion {
        background: rgba(168, 85, 247, 0.1);
        border: 1px solid rgba(168, 85, 247, 0.3);
        border-radius: 8px;
      }

      .loading-dots::after {
        content: "";
        animation: dots 1.5s steps(5, end) infinite;
      }

      @keyframes dots {
        0%,
        20% {
          content: "";
        }
        40% {
          content: ".";
        }
        60% {
          content: "..";
        }
        80%,
        100% {
          content: "...";
        }
      }

      .command-palette {
        background: var(--bg-secondary);
        border: 1px solid rgba(59, 130, 246, 0.3);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
      }

      .minimap-container {
        position: absolute;
        right: 0;
        top: 0;
        width: 120px;
        height: 100%;
        background: var(--bg-tertiary);
        border-left: 1px solid rgba(59, 130, 246, 0.2);
      }

      .breadcrumb {
        color: var(--text-secondary);
        font-size: 12px;
      }

      .breadcrumb .active {
        color: var(--accent-blue);
      }

      .context-menu {
        background: var(--bg-secondary);
        border: 1px solid rgba(59, 130, 246, 0.2);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      }

      .tooltip {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 4px;
        position: absolute;
        z-index: 1000;
        pointer-events: none;
      }

      .rahim-avatar {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.8;
        }
      }

      .rahim-thinking {
        background: linear-gradient(90deg, #667eea, #764ba2, #667eea);
        background-size: 200% 200%;
        animation: gradient 2s ease infinite;
      }

      @keyframes gradient {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .project-card {
        background: var(--bg-tertiary);
        border: 1px solid rgba(59, 130, 246, 0.2);
        transition: all 0.3s ease;
      }

      .project-card:hover {
        border-color: rgba(59, 130, 246, 0.5);
        transform: translateY(-2px);
      }

      .modal-overlay {
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
      }

      .modal {
        background: var(--bg-secondary);
        border: 1px solid rgba(59, 130, 246, 0.3);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      }

      /* Responsiveness */
      @media (max-width: 768px) {
        .sidebar {
          width: 100% !important;
          border-right: none;
          border-bottom: 1px solid rgba(59, 130, 246, 0.2);
        }
        .resizer {
          display: none;
        }
        #rightPanel {
          width: 100% !important;
          border-left: none;
          border-top: 1px solid rgba(59, 130, 246, 0.2);
        }
        .modal {
          max-width: 90vw;
        }
        .grid-cols-3 {
          grid-template-columns: repeat(1, minmax(0, 1fr));
        }
      }

      #languageSelect option {
        color: black;
      }

      #languageSelect option:checked {
        background-color: #3b82f6;
        color: white;
      }

      #editor {
        overflow-y: auto;
      }
    </style>
  </head>
  <body data-theme="dark">
    <!-- New Project Modal -->
    <div id="newProjectModal" class="fixed inset-0 modal-overlay z-50 hidden">
      <div class="flex items-center justify-center h-full p-4">
        <div
          class="modal rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden"
        >
          <div
            class="p-6 border-b border-gray-700 flex items-center justify-between"
          >
            <h2 class="text-2xl font-bold text-white">Start New Project</h2>
            <button
              onclick="closeNewProjectModal()"
              class="text-gray-400 hover:text-white"
            >
              <i class="fas fa-times text-xl"></i>
            </button>
          </div>

          <div class="p-6 overflow-y-auto max-h-[70vh]">
            <!-- Project Templates -->
            <div class="mb-8">
              <h3 class="text-lg font-semibold text-white mb-4">
                Choose a Template
              </h3>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- REST API Template -->
                <div
                  class="project-card rounded-lg p-4 cursor-pointer"
                  onclick="selectTemplate('rest-api')"
                >
                  <div class="flex items-center space-x-3 mb-3">
                    <div
                      class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center"
                    >
                      <i class="fas fa-server text-white"></i>
                    </div>
                    <div>
                      <h4 class="font-semibold text-white">REST API</h4>
                      <p class="text-xs text-gray-400">Express.js + JWT Auth</p>
                    </div>
                  </div>
                  <p class="text-sm text-gray-300 mb-3">
                    Build a secure REST API with authentication, middleware, and
                    database integration.
                  </p>
                  <div class="flex flex-wrap gap-1">
                    <span
                      class="px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded"
                      >Express</span
                    >
                    <span
                      class="px-2 py-1 bg-green-500/20 text-green-400 text-xs rounded"
                      >JWT</span
                    >
                    <span
                      class="px-2 py-1 bg-purple-500/20 text-purple-400 text-xs rounded"
                      >MongoDB</span
                    >
                  </div>
                </div>

                <!-- GraphQL API Template -->
                <div
                  class="project-card rounded-lg p-4 cursor-pointer"
                  onclick="selectTemplate('graphql')"
                >
                  <div class="flex items-center space-x-3 mb-3">
                    <div
                      class="w-10 h-10 bg-pink-500 rounded-lg flex items-center justify-center"
                    >
                      <i class="fas fa-project-diagram text-white"></i>
                    </div>
                    <div>
                      <h4 class="font-semibold text-white">GraphQL API</h4>
                      <p class="text-xs text-gray-400">
                        Apollo Server + TypeScript
                      </p>
                    </div>
                  </div>
                  <p class="text-sm text-gray-300 mb-3">
                    Create a modern GraphQL API with type safety and real-time
                    subscriptions.
                  </p>
                  <div class="flex flex-wrap gap-1">
                    <span
                      class="px-2 py-1 bg-pink-500/20 text-pink-400 text-xs rounded"
                      >GraphQL</span
                    >
                    <span
                      class="px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded"
                      >TypeScript</span
                    >
                    <span
                      class="px-2 py-1 bg-orange-500/20 text-orange-400 text-xs rounded"
                      >Apollo</span
                    >
                  </div>
                </div>

                <!-- Microservices Template -->
                <div
                  class="project-card rounded-lg p-4 cursor-pointer"
                  onclick="selectTemplate('microservices')"
                >
                  <div class="flex items-center space-x-3 mb-3">
                    <div
                      class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center"
                    >
                      <i class="fas fa-cubes text-white"></i>
                    </div>
                    <div>
                      <h4 class="font-semibold text-white">Microservices</h4>
                      <p class="text-xs text-gray-400">Docker + Kubernetes</p>
                    </div>
                  </div>
                  <p class="text-sm text-gray-300 mb-3">
                    Build scalable microservices architecture with
                    containerization and orchestration.
                  </p>
                  <div class="flex flex-wrap gap-1">
                    <span
                      class="px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded"
                      >Docker</span
                    >
                    <span
                      class="px-2 py-1 bg-green-500/20 text-green-400 text-xs rounded"
                      >Kubernetes</span
                    >
                    <span
                      class="px-2 py-1 bg-red-500/20 text-red-400 text-xs rounded"
                      >Redis</span
                    >
                  </div>
                </div>

                <!-- Real-time Chat Template -->
                <div
                  class="project-card rounded-lg p-4 cursor-pointer"
                  onclick="selectTemplate('realtime-chat')"
                >
                  <div class="flex items-center space-x-3 mb-3">
                    <div
                      class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center"
                    >
                      <i class="fas fa-comments text-white"></i>
                    </div>
                    <div>
                      <h4 class="font-semibold text-white">Real-time Chat</h4>
                      <p class="text-xs text-gray-400">Socket.io + Redis</p>
                    </div>
                  </div>
                  <p class="text-sm text-gray-300 mb-3">
                    Create a real-time chat application with WebSocket
                    connections and message persistence.
                  </p>
                  <div class="flex flex-wrap gap-1">
                    <span
                      class="px-2 py-1 bg-purple-500/20 text-purple-400 text-xs rounded"
                      >Socket.io</span
                    >
                    <span
                      class="px-2 py-1 bg-red-500/20 text-red-400 text-xs rounded"
                      >Redis</span
                    >
                    <span
                      class="px-2 py-1 bg-green-500/20 text-green-400 text-xs rounded"
                      >MongoDB</span
                    >
                  </div>
                </div>

                <!-- E-commerce API Template -->
                <div
                  class="project-card rounded-lg p-4 cursor-pointer"
                  onclick="selectTemplate('ecommerce')"
                >
                  <div class="flex items-center space-x-3 mb-3">
                    <div
                      class="w-10 h-10 bg-yellow-500 rounded-lg flex items-center justify-center"
                    >
                      <i class="fas fa-shopping-cart text-white"></i>
                    </div>
                    <div>
                      <h4 class="font-semibold text-white">E-commerce API</h4>
                      <p class="text-xs text-gray-400">Stripe + PostgreSQL</p>
                    </div>
                  </div>
                  <p class="text-sm text-gray-300 mb-3">
                    Build a complete e-commerce backend with payments,
                    inventory, and order management.
                  </p>
                  <div class="flex flex-wrap gap-1">
                    <span
                      class="px-2 py-1 bg-yellow-500/20 text-yellow-400 text-xs rounded"
                      >Stripe</span
                    >
                    <span
                      class="px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded"
                      >PostgreSQL</span
                    >
                    <span
                      class="px-2 py-1 bg-green-500/20 text-green-400 text-xs rounded"
                      >Express</span
                    >
                  </div>
                </div>

                <!-- Django Project Template -->
                <div
                  class="project-card rounded-lg p-4 cursor-pointer"
                  onclick="selectTemplate('django')"
                >
                  <div class="flex items-center space-x-3 mb-3">
                    <div
                      class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center"
                    >
                      <i class="fab fa-python text-white"></i>
                    </div>
                    <div>
                      <h4 class="font-semibold text-white">Django API</h4>
                      <p class="text-xs text-gray-400">
                        Python Django REST Framework
                      </p>
                    </div>
                  </div>
                  <p class="text-sm text-gray-300 mb-3">
                    Build a robust API with Django and REST framework.
                  </p>
                  <div class="flex flex-wrap gap-1">
                    <span
                      class="px-2 py-1 bg-green-500/20 text-green-400 text-xs rounded"
                      >Django</span
                    >
                    <span
                      class="px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded"
                      >Python</span
                    >
                    <span
                      class="px-2 py-1 bg-purple-500/20 text-purple-400 text-xs rounded"
                      >REST</span
                    >
                  </div>
                </div>

                <!-- Rust Project Template -->
                <div
                  class="project-card rounded-lg p-4 cursor-pointer"
                  onclick="selectTemplate('rust')"
                >
                  <div class="flex items-center space-x-3 mb-3">
                    <div
                      class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center"
                    >
                      <i class="fas fa-tools text-white"></i>
                    </div>
                    <div>
                      <h4 class="font-semibold text-white">Rust API</h4>
                      <p class="text-xs text-gray-400">Actix-web framework</p>
                    </div>
                  </div>
                  <p class="text-sm text-gray-300 mb-3">
                    Create a high-performance API with Rust and Actix.
                  </p>
                  <div class="flex flex-wrap gap-1">
                    <span
                      class="px-2 py-1 bg-orange-500/20 text-orange-400 text-xs rounded"
                      >Rust</span
                    >
                    <span
                      class="px-2 py-1 bg-red-500/20 text-red-400 text-xs rounded"
                      >Actix</span
                    >
                  </div>
                </div>

                <!-- Laravel Project Template -->
                <div
                  class="project-card rounded-lg p-4 cursor-pointer"
                  onclick="selectTemplate('laravel')"
                >
                  <div class="flex items-center space-x-3 mb-3">
                    <div
                      class="w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center"
                    >
                      <i class="fab fa-laravel text-white"></i>
                    </div>
                    <div>
                      <h4 class="font-semibold text-white">Laravel API</h4>
                      <p class="text-xs text-gray-400">PHP Laravel framework</p>
                    </div>
                  </div>
                  <p class="text-sm text-gray-300 mb-3">
                    Build an elegant API with Laravel.
                  </p>
                  <div class="flex flex-wrap gap-1">
                    <span
                      class="px-2 py-1 bg-red-500/20 text-red-400 text-xs rounded"
                      >Laravel</span
                    >
                    <span
                      class="px-2 py-1 bg-purple-500/20 text-purple-400 text-xs rounded"
                      >PHP</span
                    >
                  </div>
                </div>

                <!-- Firebase Project Template -->
                <div
                  class="project-card rounded-lg p-4 cursor-pointer"
                  onclick="selectTemplate('firebase')"
                >
                  <div class="flex items-center space-x-3 mb-3">
                    <div
                      class="w-10 h-10 bg-yellow-500 rounded-lg flex items-center justify-center"
                    >
                      <i class="fas fa-fire text-white"></i>
                    </div>
                    <div>
                      <h4 class="font-semibold text-white">Firebase Backend</h4>
                      <p class="text-xs text-gray-400">Node.js + Firebase</p>
                    </div>
                  </div>
                  <p class="text-sm text-gray-300 mb-3">
                    Serverless backend with Firebase and Node.js.
                  </p>
                  <div class="flex flex-wrap gap-1">
                    <span
                      class="px-2 py-1 bg-yellow-500/20 text-yellow-400 text-xs rounded"
                      >Firebase</span
                    >
                    <span
                      class="px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded"
                      >Node.js</span
                    >
                  </div>
                </div>

                <!-- Blank Project Template -->
                <div
                  class="project-card rounded-lg p-4 cursor-pointer"
                  onclick="selectTemplate('blank')"
                >
                  <div class="flex items-center space-x-3 mb-3">
                    <div
                      class="w-10 h-10 bg-gray-500 rounded-lg flex items-center justify-center"
                    >
                      <i class="fas fa-file-code text-white"></i>
                    </div>
                    <div>
                      <h4 class="font-semibold text-white">Blank Project</h4>
                      <p class="text-xs text-gray-400">Start from scratch</p>
                    </div>
                  </div>
                  <p class="text-sm text-gray-300 mb-3">
                    Start with an empty project and build exactly what you need.
                  </p>
                  <div class="flex flex-wrap gap-1">
                    <span
                      class="px-2 py-1 bg-gray-500/20 text-gray-400 text-xs rounded"
                      >Custom</span
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- Project Configuration -->
            <div class="border-t border-gray-700 pt-6">
              <h3 class="text-lg font-semibold text-white mb-4">
                Project Configuration
              </h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2"
                    >Project Name</label
                  >
                  <input
                    type="text"
                    id="projectName"
                    class="w-full bg-gray-700 text-white rounded px-3 py-2 border border-gray-600 focus:border-blue-500 focus:outline-none"
                    placeholder="my-awesome-project"
                    value=""
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2"
                    >Description</label
                  >
                  <input
                    type="text"
                    id="projectDescription"
                    class="w-full bg-gray-700 text-white rounded px-3 py-2 border border-gray-600 focus:border-blue-500 focus:outline-none"
                    placeholder="A brief description of your project"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2"
                    >Node.js Version</label
                  >
                  <select
                    id="nodeVersion"
                    class="w-full bg-gray-700 text-white rounded px-3 py-2 border border-gray-600 focus:border-blue-500 focus:outline-none"
                  >
                    <option value="18">Node.js 18 LTS</option>
                    <option value="20" selected>Node.js 20 LTS</option>
                    <option value="21">Node.js 21</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2"
                    >Package Manager</label
                  >
                  <select
                    id="packageManager"
                    class="w-full bg-gray-700 text-white rounded px-3 py-2 border border-gray-600 focus:border-blue-500 focus:outline-none"
                  >
                    <option value="npm" selected>npm</option>
                    <option value="yarn">Yarn</option>
                    <option value="pnpm">pnpm</option>
                  </select>
                </div>
              </div>

              <!-- Additional Options -->
              <div class="mt-6">
                <h4 class="text-md font-medium text-white mb-3">
                  Additional Options
                </h4>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                  <label class="flex items-center space-x-2">
                    <input
                      type="checkbox"
                      id="includeDocker"
                      class="rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500"
                    />
                    <span class="text-sm text-gray-300">Docker Setup</span>
                  </label>
                  <label class="flex items-center space-x-2">
                    <input
                      type="checkbox"
                      id="includeTests"
                      checked
                      class="rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500"
                    />
                    <span class="text-sm text-gray-300">Testing Framework</span>
                  </label>
                  <label class="flex items-center space-x-2">
                    <input
                      type="checkbox"
                      id="includeESLint"
                      checked
                      class="rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500"
                    />
                    <span class="text-sm text-gray-300">ESLint + Prettier</span>
                  </label>
                  <label class="flex items-center space-x-2">
                    <input
                      type="checkbox"
                      id="includeTypeScript"
                      class="rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500"
                    />
                    <span class="text-sm text-gray-300">TypeScript</span>
                  </label>
                  <label class="flex items-center space-x-2">
                    <input
                      type="checkbox"
                      id="includeCI"
                      class="rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500"
                    />
                    <span class="text-sm text-gray-300">GitHub Actions</span>
                  </label>
                  <label class="flex items-center space-x-2">
                    <input
                      type="checkbox"
                      id="includeSwagger"
                      class="rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500"
                    />
                    <span class="text-sm text-gray-300">API Documentation</span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <div class="p-6 border-t border-gray-700 flex justify-between">
            <button
              onclick="closeNewProjectModal()"
              class="px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors"
            >
              Cancel
            </button>
            <button
              onclick="createNewProject()"
              class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors"
            >
              <i class="fas fa-rocket mr-2"></i>Create Project
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Create File Modal -->
    <div id="createFileModal" class="fixed inset-0 modal-overlay z-50 hidden">
      <div class="flex items-center justify-center h-full p-4">
        <div class="modal rounded-lg w-full max-w-md">
          <div class="p-4 border-b border-gray-700">
            <h2 class="text-xl font-bold text-white">Create New File</h2>
          </div>
          <div class="p-4">
            <label class="block text-sm font-medium text-gray-300 mb-2">File Path</label>
            <input type="text" id="filePathInput" class="w-full bg-gray-700 text-white rounded px-3 py-2 border border-gray-600 focus:border-blue-500 focus:outline-none" placeholder="e.g., src/new.js" />
          </div>
          <div class="p-4 border-t border-gray-700 flex justify-end space-x-2">
            <button onclick="closeCreateFileModal()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded">Cancel</button>
            <button onclick="confirmCreateFile()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded">Create</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Create Folder Modal -->
    <div id="createFolderModal" class="fixed inset-0 modal-overlay z-50 hidden">
      <div class="flex items-center justify-center h-full p-4">
        <div class="modal rounded-lg w-full max-w-md">
          <div class="p-4 border-b border-gray-700">
            <h2 class="text-xl font-bold text-white">Create New Folder</h2>
          </div>
          <div class="p-4">
            <label class="block text-sm font-medium text-gray-300 mb-2">Folder Path</label>
            <input type="text" id="folderPathInput" class="w-full bg-gray-700 text-white rounded px-3 py-2 border border-gray-600 focus:border-blue-500 focus:outline-none" placeholder="e.g., src/newfolder" />
          </div>
          <div class="p-4 border-t border-gray-700 flex justify-end space-x-2">
            <button onclick="closeCreateFolderModal()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded">Cancel</button>
            <button onclick="confirmCreateFolder()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded">Create</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Command Palette -->
    <div
      id="commandPalette"
      class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden"
    >
      <div class="flex items-start justify-center pt-20">
        <div class="command-palette rounded-lg w-96 max-h-96 overflow-hidden">
          <div class="p-4 border-b border-gray-700">
            <input
              type="text"
              id="commandInput"
              class="w-full bg-transparent text-white outline-none"
              placeholder="Type a command..."
              onkeyup="filterCommands(event)"
            />
          </div>
          <div id="commandList" class="max-h-64 overflow-y-auto">
            <!-- Commands will be populated here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Panel -->
    <div
      id="settingsPanel"
      class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden"
    >
      <div class="flex items-center justify-center h-full">
        <div class="settings-panel rounded-lg w-96 max-h-96 overflow-hidden">
          <div
            class="p-4 border-b border-gray-700 flex items-center justify-between"
          >
            <h3 class="text-lg font-semibold">Settings</h3>
            <button
              onclick="closeSettings()"
              class="text-gray-400 hover:text-white"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="p-4 space-y-4 max-h-80 overflow-y-auto">
            <!-- Gemini API Key -->
            <div>
              <label class="block text-sm font-medium mb-2"
                >Gemini API Key (for Rahim AI)</label
              >
              <input
                type="password"
                id="geminiApiKey"
                class="w-full bg-gray-700 text-white rounded px-3 py-2 text-sm"
                placeholder="AIzaSy..."
                value="AIzaSyAq6QATs5YOVtHM46Lp9cXVY1c9d1qmr8g"
              />
              <div class="text-xs text-gray-400 mt-1">
                Get your key from
                <a
                  href="https://makersuite.google.com/app/apikey"
                  target="_blank"
                  class="text-blue-400"
                  >Google AI Studio</a
                >
              </div>
            </div>

            <!-- Theme Selection -->
            <div>
              <label class="block text-sm font-medium mb-2">Theme</label>
              <select
                id="themeSelect"
                onchange="changeTheme()"
                class="w-full bg-gray-700 text-white rounded px-3 py-2"
              >
                <option value="dark">Dark</option>
                <option value="light">Light</option>
                <option value="high-contrast">High Contrast</option>
              </select>
            </div>

            <!-- Font Size -->
            <div>
              <label class="block text-sm font-medium mb-2">Font Size</label>
              <input
                type="range"
                id="fontSizeSlider"
                min="10"
                max="24"
                value="14"
                onchange="changeFontSize()"
                class="w-full"
              />
              <span id="fontSizeValue" class="text-sm text-gray-400">14px</span>
            </div>

            <!-- Auto Save -->
            <div class="flex items-center justify-between">
              <label class="text-sm font-medium">Auto Save</label>
              <input
                type="checkbox"
                id="autoSaveToggle"
                checked
                onchange="toggleAutoSave()"
                class="rounded"
              />
            </div>

            <!-- Minimap -->
            <div class="flex items-center justify-between">
              <label class="text-sm font-medium">Show Minimap</label>
              <input
                type="checkbox"
                id="minimapToggle"
                checked
                onchange="toggleMinimap()"
                class="rounded"
              />
            </div>

            <!-- Word Wrap -->
            <div class="flex items-center justify-between">
              <label class="text-sm font-medium">Word Wrap</label>
              <input
                type="checkbox"
                id="wordWrapToggle"
                checked
                onchange="toggleWordWrap()"
                class="rounded"
              />
            </div>

            <!-- Tab Size -->
            <div>
              <label class="block text-sm font-medium mb-2">Tab Size</label>
              <select
                id="tabSizeSelect"
                onchange="changeTabSize()"
                class="w-full bg-gray-700 text-white rounded px-3 py-2"
              >
                <option value="2">2 spaces</option>
                <option value="4" selected>4 spaces</option>
                <option value="8">8 spaces</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu rounded hidden fixed z-50">
      <div class="py-1">
        <button
          onclick="contextAction('cut')"
          class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-700"
        >
          <i class="fas fa-cut mr-2"></i>Cut
        </button>
        <button
          onclick="contextAction('copy')"
          class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-700"
        >
          <i class="fas fa-copy mr-2"></i>Copy
        </button>
        <button
          onclick="contextAction('paste')"
          class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-700"
        >
          <i class="fas fa-paste mr-2"></i>Paste
        </button>
        <hr class="border-gray-700 my-1" />
        <button
          onclick="contextAction('format')"
          class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-700"
        >
          <i class="fas fa-code mr-2"></i>Format Document
        </button>
        <button
          onclick="contextAction('find')"
          class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-700"
        >
          <i class="fas fa-search mr-2"></i>Find & Replace
        </button>
      </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2">
      <!-- Notifications will be added here -->
    </div>

    <!-- Top Navigation Bar -->
    <div
      class="h-12 bg-gray-900 border-b border-blue-500/20 flex items-center justify-between px-4"
    >
      <!-- Left: Menu and Breadcrumb -->
      <div class="flex items-center space-x-4">
        <button
          onclick="showNewProjectModal()"
          class="text-gray-400 hover:text-blue-400 transition-colors"
          title="New Project"
        >
          <i class="fas fa-plus"></i>
        </button>
        <button
          onclick="goBack()"
          class="text-gray-400 hover:text-blue-400 transition-colors"
          title="Go Back"
        >
          <i class="fas fa-arrow-left"></i>
        </button>
        <div class="breadcrumb flex items-center space-x-2 text-sm">
          <span class="text-gray-400">Backend Mentor</span>
          <i class="fas fa-chevron-right text-gray-600 text-xs"></i>
          <span class="active" id="currentProjectName"
            >REST API Authentication</span
          >
        </div>
      </div>

      <!-- Center: Challenge Info -->
      <div class="flex items-center space-x-4">
        <div class="flex items-center space-x-2">
          <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
          <span class="text-sm text-gray-300" id="autoSaveStatus"
            >Auto-save enabled</span
          >
        </div>
        <div class="text-sm text-gray-400">
          <i class="fas fa-clock mr-1"></i>
          <span id="timer">00:00</span>
        </div>
      </div>

      <!-- Right: Actions -->
      <div class="flex items-center space-x-3">
        <button
          onclick="openSettings()"
          class="text-gray-400 hover:text-blue-400 transition-colors"
          title="Settings (Ctrl+,)"
        >
          <i class="fas fa-cog"></i>
        </button>
        <button
          onclick="shareSession()"
          class="text-gray-400 hover:text-blue-400 transition-colors"
          title="Share Session"
        >
          <i class="fas fa-share-alt"></i>
        </button>
        <button
          onclick="toggleAI()"
          class="text-gray-400 hover:text-purple-400 transition-colors"
          title="Rahim AI Assistant (Ctrl+/)"
        >
          <i class="fas fa-robot"></i>
        </button>
        <button
          onclick="runCode()"
          class="bg-green-600 hover:bg-green-700 px-4 py-1 rounded text-sm font-medium transition-colors"
          title="Run Code (F5)"
        >
          <i class="fas fa-play mr-1"></i>Run
        </button>
        <button
          onclick="submitCode()"
          class="bg-blue-600 hover:bg-blue-700 px-4 py-1 rounded text-sm font-medium transition-colors"
          title="Submit Solution"
        >
          <i class="fas fa-paper-plane mr-1"></i>Submit
        </button>
      </div>
    </div>

    <div class="flex h-[calc(100vh-4.5rem)] flex-col md:flex-row overflow-hidden" >
      <!-- Left Sidebar - File Explorer -->
      <div class="w-full md:w-64 sidebar flex flex-col overflow-hidden" id="sidebar">
        <!-- Explorer Header -->
        <div class="p-3 border-b border-gray-700">
          <div class="flex items-center justify-between">
            <h3 class="text-sm font-semibold text-gray-300">EXPLORER</h3>
            <div class="flex space-x-1">
              <button
                onclick="showCreateFileModal()"
                class="text-gray-400 hover:text-blue-400 text-xs"
                title="New File"
              >
                <i class="fa-solid fa-file-circle-plus"></i>
              </button>
              <button
                onclick="showCreateFolderModal()"
                class="text-gray-400 hover:text-blue-400 text-xs"
                title="New Folder"
              >
                <i class="fas fa-folder-plus"></i>
              </button>
              <button
                onclick="refreshFiles()"
                class="text-gray-400 hover:text-blue-400 text-xs"
                title="Refresh"
              >
                <i class="fas fa-sync-alt"></i>
              </button>
              <button
                onclick="collapseAll()"
                class="text-gray-400 hover:text-blue-400 text-xs"
                title="Collapse All"
              >
                <i class="fas fa-compress-alt"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- File Tree -->
        <div class="flex-1 overflow-y-auto p-2" id="fileTree">
          <div class="space-y-1" id="fileTreeContent">
            <!-- Project files will be populated here -->
          </div>
        </div>

        <!-- Challenge Progress -->
        <div class="p-3 border-t border-gray-700">
          <div class="mb-2">
            <div
              class="flex items-center justify-between text-xs text-gray-400 mb-1"
            >
              <span>Progress</span>
              <span id="progressText">3/5 tests</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-2">
              <div
                id="progressBar"
                class="bg-blue-500 h-2 rounded-full transition-all duration-500"
                style="width: 60%"
              ></div>
            </div>
          </div>
          <div class="text-xs text-gray-400" id="taskList">
            <div class="flex items-center space-x-2 mb-1">
              <i class="fas fa-check-circle text-green-500"></i>
              <span>Basic server setup</span>
            </div>
            <div class="flex items-center space-x-2 mb-1">
              <i class="fas fa-check-circle text-green-500"></i>
              <span>JWT implementation</span>
            </div>
            <div class="flex items-center space-x-2 mb-1">
              <i class="fas fa-check-circle text-green-500"></i>
              <span>Login endpoint</span>
            </div>
            <div class="flex items-center space-x-2 mb-1">
              <i class="fas fa-clock text-yellow-500"></i>
              <span>Protected routes</span>
            </div>
            <div class="flex items-center space-x-2">
              <i class="fas fa-circle text-gray-600"></i>
              <span>Error handling</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Resizer -->
      <div
        class="w-1 resizer md:block hidden"
        onmousedown="startResize(event, 'sidebar')"
      ></div>

      <!-- Main Content Area -->
      <div class="flex-1 flex flex-col overflow-hidden" >
        <!-- Tab Bar -->
        <div
          class="h-10 bg-gray-800 border-b border-gray-700 flex items-center overflow-x-auto"
          id="tabBar"
        >
          <div class="flex" id="openTabs">
            <!-- Tabs will be populated here -->
          </div>
          <div class="flex-1"></div>
          <div class="flex items-center space-x-2 px-4">
            <button
              onclick="splitEditor()"
              class="text-gray-400 hover:text-white text-xs"
              title="Split Editor"
            >
              <i class="fas fa-columns"></i>
            </button>
            <button
              onclick="toggleZenMode()"
              class="text-gray-400 hover:text-white text-xs"
              title="Zen Mode"
            >
              <i class="fas fa-expand"></i>
            </button>
          </div>
        </div>

        <!-- Editor and Right Panel Container -->
        <div class="flex-1 flex overflow-hidden" >
          <!-- Monaco Editor -->
          <div class="flex-1 relative overflow-auto">
            <div id="editor" class="h-full"></div>

            <!-- Find and Replace Widget -->
            <div
              id="findWidget"
              class="absolute top-4 right-4 bg-gray-800 border border-gray-600 rounded p-3 hidden"
            >
              <div class="flex items-center space-x-2 mb-2">
                <input
                  type="text"
                  id="findInput"
                  placeholder="Find"
                  class="bg-gray-700 text-white px-2 py-1 text-sm rounded"
                />
                <button
                  onclick="findNext()"
                  class="text-gray-400 hover:text-white"
                >
                  <i class="fas fa-chevron-down"></i>
                </button>
                <button
                  onclick="findPrevious()"
                  class="text-gray-400 hover:text-white"
                >
                  <i class="fas fa-chevron-up"></i>
                </button>
                <button
                  onclick="closeFindWidget()"
                  class="text-gray-400 hover:text-white"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <div class="flex items-center space-x-2">
                <input
                  type="text"
                  id="replaceInput"
                  placeholder="Replace"
                  class="bg-gray-700 text-white px-2 py-1 text-sm rounded"
                />
                <button
                  onclick="replaceNext()"
                  class="text-gray-400 hover:text-white text-xs"
                >
                  <i class="fas fa-exchange-alt"></i>
                </button>
                <button
                  onclick="replaceAll()"
                  class="text-gray-400 hover:text-white text-xs"
                >
                  <i class="fas fa-sync-alt"></i>
                </button>
              </div>
            </div>

            <!-- AI Inline Suggestions -->
            <div id="aiSuggestions" class="absolute top-4 right-4 w-80 hidden">
              <div class="ai-suggestion p-4">
                <div class="flex items-start space-x-3">
                  <div
                    class="w-8 h-8 rahim-avatar rounded-full flex items-center justify-center"
                  >
                    <i class="fas fa-robot text-white text-sm"></i>
                  </div>
                  <div class="flex-1">
                    <div class="text-sm font-medium text-purple-400 mb-2">
                      Rahim's Suggestion
                    </div>
                    <div class="text-sm text-gray-300 mb-3" id="suggestionText">
                      I notice your JWT verification needs proper error
                      handling. Let me help you implement it securely:
                    </div>
                    <div
                      class="bg-gray-900 rounded p-2 text-xs font-mono text-green-400 mb-3"
                      id="suggestionCode"
                    >
                      try {<br />
                      &nbsp;&nbsp;const decoded = jwt.verify(token,
                      JWT_SECRET);<br />
                      &nbsp;&nbsp;req.user = decoded;<br />
                      &nbsp;&nbsp;next();<br />
                      } catch (error) {<br />
                      &nbsp;&nbsp;return res.status(401).json({error: 'Invalid
                      token'});<br />
                      }
                    </div>
                    <div class="flex space-x-2">
                      <button
                        onclick="applySuggestion()"
                        class="bg-purple-600 hover:bg-purple-700 px-3 py-1 rounded text-xs text-white"
                      >
                        Apply Fix
                      </button>
                      <button
                        onclick="dismissSuggestion()"
                        class="bg-gray-600 hover:bg-gray-700 px-3 py-1 rounded text-xs text-white"
                      >
                        Dismiss
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Resizer -->
          <div
            class="w-1 resizer md:block hidden"
            onmousedown="startResize(event, 'rightPanel')"
          ></div>

          <!-- Right Panel -->
          <div
            class="w-full md:w-96 bg-gray-800 border-l border-gray-700 flex flex-col overflow-hidden"
            id="rightPanel"
          >
            <!-- Panel Tabs -->
            <div class="h-10 bg-gray-900 border-b border-gray-700 flex">
              <button
                onclick="switchRightPanel('output')"
                class="flex-1 text-sm text-gray-400 hover:text-white border-r border-gray-700 tab-active"
                id="outputTab"
              >
                <i class="fas fa-terminal mr-1"></i>Output
              </button>
              <button
                onclick="switchRightPanel('api')"
                class="flex-1 text-sm text-gray-400 hover:text-white border-r border-gray-700"
                id="apiTab"
              >
                <i class="fas fa-flask mr-1"></i>API Test
              </button>
              <button
                onclick="switchRightPanel('tests')"
                class="flex-1 text-sm text-gray-400 hover:text-white"
                id="testsTab"
              >
                <i class="fas fa-check-circle mr-1"></i>Tests
              </button>
            </div>

            <!-- Output Panel -->
            <div id="outputPanel" class="flex-1 flex flex-col overflow-hidden">
              <!-- Terminal Header -->
              <div
                class="flex items-center justify-between p-2 border-b border-gray-700"
              >
                <div class="flex items-center space-x-2">
                  <span class="text-xs text-gray-400">Terminal</span>
                  <div class="flex space-x-1">
                    <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                    <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                  </div>
                </div>
                <div class="flex space-x-2">
                  <button
                    onclick="clearTerminal()"
                    class="text-gray-400 hover:text-white text-xs"
                    title="Clear Terminal"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                  <button
                    onclick="splitTerminal()"
                    class="text-gray-400 hover:text-white text-xs"
                    title="Split Terminal"
                  >
                    <i class="fas fa-columns"></i>
                  </button>
                  <button
                    onclick="newTerminal()"
                    class="text-gray-400 hover:text-white text-xs"
                    title="New Terminal"
                  >
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>

              <!-- Terminal -->
              <div
                class="flex-1 terminal p-4 overflow-y-auto font-mono text-sm "
                id="terminalOutput"
              >
                <div class="text-green-400">
                  Welcome to Backend Mentor Terminal
                </div>
                <div class="text-gray-300">
                  Type 'help' for available commands
                </div>
                <div class="text-blue-400">[INFO] Project: rest-api-auth</div>
                <div class="text-green-400">[SUCCESS] Environment loaded</div>
                <div class="text-purple-400">
                  [AI] Rahim is ready to assist you!
                </div>
                <div class="text-gray-300">
                  @backendmentor: <span class="animate-pulse">|</span>
                </div>
              </div>

              <!-- Terminal Input -->
              <div class="border-t border-gray-700 p-2">
                <div class="flex items-center space-x-2">
                  <span class="text-green-400 text-sm" id="terminalPrompt"
                    >@@backendmentor:</span
                  >
                  <input
                    type="text"
                    id="terminalInput"
                    class="terminal-input"
                    placeholder="Type command..."
                    onkeypress="handleTerminalInput(event)"
                  />
                </div>
              </div>
            </div>

            <!-- API Test Panel -->
            <div id="apiPanel" class="flex-1 flex-col hidden overflow-y-auto">
              <div class="p-4 space-y-4">
                <!-- Request Builder -->
                <div>
                  <div class="flex items-center space-x-2 mb-2">
                    <select
                      id="httpMethod"
                      class="bg-gray-700 text-white text-sm rounded px-2 py-1 border border-gray-600"
                    >
                      <option value="GET">GET</option>
                      <option value="POST" selected>POST</option>
                      <option value="PUT">PUT</option>
                      <option value="DELETE">DELETE</option>
                      <option value="PATCH">PATCH</option>
                    </select>
                    <input
                      type="text"
                      id="apiUrl"
                      class="flex-1 bg-gray-700 text-white text-sm rounded px-3 py-1 border border-gray-600"
                      placeholder="http://localhost:3000/api/auth/login"
                      value="http://localhost:3000/api/auth/login"
                    />
                    <button
                      onclick="saveRequest()"
                      class="text-gray-400 hover:text-white text-sm"
                      title="Save Request"
                    >
                      <i class="fas fa-save"></i>
                    </button>
                  </div>

                  <!-- Headers -->
                  <div class="mb-3">
                    <div class="flex items-center justify-between mb-2">
                      <div class="text-sm text-gray-400">Headers</div>
                      <button
                        onclick="addHeader()"
                        class="text-blue-400 hover:text-blue-300 text-xs"
                      >
                        <i class="fas fa-plus mr-1"></i>Add Header
                      </button>
                    </div>
                    <div id="headersContainer" class="space-y-2">
                      <div class="flex space-x-2">
                        <input
                          type="text"
                          class="flex-1 bg-gray-700 text-white text-xs rounded px-2 py-1 border border-gray-600"
                          placeholder="Content-Type"
                          value="Content-Type"
                        />
                        <input
                          type="text"
                          class="flex-1 bg-gray-700 text-white text-xs rounded px-2 py-1 border border-gray-600"
                          placeholder="application/json"
                          value="application/json"
                        />
                        <button
                          onclick="removeHeader(this)"
                          class="text-red-400 hover:text-red-300 text-xs"
                        >
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </div>
                  </div>

                  <!-- Body -->
                  <div class="mb-3">
                    <div class="flex items-center justify-between mb-2">
                      <div class="text-sm text-gray-400">Body</div>
                      <select
                        id="bodyType"
                        onchange="changeBodyType()"
                        class="bg-gray-700 text-white text-xs rounded px-2 py-1"
                      >
                        <option value="json">JSON</option>
                        <option value="form">Form Data</option>
                        <option value="raw">Raw</option>
                      </select>
                    </div>
                    <textarea
                      id="requestBody"
                      class="w-full bg-gray-700 text-white text-xs rounded px-2 py-2 border border-gray-600 font-mono h-20"
                      placeholder='{"email": "user@example.com", "password": "password123"}'
                    >
{"email": "user@example.com", "password": "password123"}</textarea
                    >
                  </div>

                  <div class="flex space-x-2">
                    <button
                      onclick="sendAPIRequest()"
                      class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded text-sm font-medium"
                    >
                      <i class="fas fa-paper-plane mr-1"></i>Send Request
                    </button>
                    <button
                      onclick="generateCode()"
                      class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded text-sm"
                      title="Generate Code"
                    >
                      <i class="fas fa-code"></i>
                    </button>
                  </div>
                </div>

                <!-- Response -->
                <div class="border-t border-gray-700 pt-4">
                  <div class="flex items-center justify-between mb-2">
                    <div class="text-sm text-gray-400">Response</div>
                    <div class="flex space-x-2">
                      <button
                        onclick="copyResponse()"
                        class="text-gray-400 hover:text-white text-xs"
                        title="Copy Response"
                      >
                        <i class="fas fa-copy"></i>
                      </button>
                      <button
                        onclick="formatResponse()"
                        class="text-gray-400 hover:text-white text-xs"
                        title="Format JSON"
                      >
                        <i class="fas fa-align-left"></i>
                      </button>
                    </div>
                  </div>
                  <div
                    class="bg-gray-900 rounded p-3 text-xs font-mono"
                    id="apiResponse"
                  >
                    <div class="flex items-center space-x-2 mb-2">
                      <span class="text-green-400" id="responseStatus"
                        >200 OK</span
                      >
                      <span class="text-gray-400"></span>
                      <span class="text-gray-400" id="responseTime">142ms</span>
                      <span class="text-gray-400"></span>
                      <span class="text-gray-400" id="responseSize">1.2KB</span>
                    </div>
                    <div class="text-gray-300" id="responseBody">
                      {<br />
                      &nbsp;&nbsp;"success": true,<br />
                      &nbsp;&nbsp;"token":
                      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",<br />
                      &nbsp;&nbsp;"user": {<br />
                      &nbsp;&nbsp;&nbsp;&nbsp;"id": "123",<br />
                      &nbsp;&nbsp;&nbsp;&nbsp;"email": "user@example.com"<br />
                      &nbsp;&nbsp;}<br />
                      }
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Tests Panel -->
            <div id="testsPanel" class="flex-1 flex-col hidden overflow-y-auto">
              <div class="p-4">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-sm font-semibold text-white">Test Results</h3>
                  <div class="flex space-x-2">
                    <button
                      onclick="runTests()"
                      class="bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-xs text-white"
                    >
                      <i class="fas fa-play mr-1"></i>Run Tests
                    </button>
                    <button
                      onclick="debugTests()"
                      class="bg-yellow-600 hover:bg-yellow-700 px-3 py-1 rounded text-xs text-white"
                    >
                      <i class="fas fa-bug mr-1"></i>Debug
                    </button>
                    <button
                      onclick="watchTests()"
                      class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-xs text-white"
                    >
                      <i class="fas fa-eye mr-1"></i>Watch
                    </button>
                  </div>
                </div>

                <div class="space-y-3" id="testResults">
                  <div
                    class="flex items-center space-x-3 p-2 bg-green-500/10 border border-green-500/20 rounded"
                  >
                    <i class="fas fa-check-circle test-passed"></i>
                    <div class="flex-1">
                      <div class="text-sm text-white">
                        Server starts successfully
                      </div>
                      <div class="text-xs text-gray-400">
                         Express server listening on port 3000
                      </div>
                    </div>
                    <div class="text-xs text-gray-400">12ms</div>
                  </div>

                  <div
                    class="flex items-center space-x-3 p-2 bg-green-500/10 border border-green-500/20 rounded"
                  >
                    <i class="fas fa-check-circle test-passed"></i>
                    <div class="flex-1">
                      <div class="text-sm text-white">JWT token generation</div>
                      <div class="text-xs text-gray-400">
                         Valid JWT token created on login
                      </div>
                    </div>
                    <div class="text-xs text-gray-400">8ms</div>
                  </div>

                  <div
                    class="flex items-center space-x-3 p-2 bg-green-500/10 border border-green-500/20 rounded"
                  >
                    <i class="fas fa-check-circle test-passed"></i>
                    <div class="flex-1">
                      <div class="text-sm text-white">Login endpoint works</div>
                      <div class="text-xs text-gray-400">
                         POST /api/auth/login returns 200
                      </div>
                    </div>
                    <div class="text-xs text-gray-400">45ms</div>
                  </div>

                  <div
                    class="flex items-center space-x-3 p-2 bg-yellow-500/10 border border-yellow-500/20 rounded"
                  >
                    <i class="fas fa-clock test-pending"></i>
                    <div class="flex-1">
                      <div class="text-sm text-white">
                        Protected route middleware
                      </div>
                      <div class="text-xs text-gray-400">
                         Middleware function needs implementation
                      </div>
                    </div>
                    <div class="text-xs text-gray-400">-</div>
                  </div>

                  <div
                    class="flex items-center space-x-3 p-2 bg-red-500/10 border border-red-500/20 rounded"
                  >
                    <i class="fas fa-times-circle test-failed"></i>
                    <div class="flex-1">
                      <div class="text-sm text-white">Error handling</div>
                      <div class="text-xs text-gray-400">
                         Missing try-catch blocks for JWT operations
                      </div>
                    </div>
                    <div class="text-xs text-gray-400">3ms</div>
                  </div>
                </div>

                <!-- Test Summary -->
                <div class="mt-6 p-3 bg-gray-900 rounded">
                  <div class="text-sm text-gray-400 mb-2">Test Summary</div>
                  <div class="flex items-center justify-between text-xs mb-2">
                    <span class="text-green-400">3 Passed</span>
                    <span class="text-yellow-400">1 Pending</span>
                    <span class="text-red-400">1 Failed</span>
                    <span class="text-gray-400">68ms</span>
                  </div>
                  <div class="w-full bg-gray-700 rounded-full h-2">
                    <div
                      class="bg-green-500 h-2 rounded-l-full"
                      style="width: 60%"
                    ></div>
                  </div>
                </div>

                <!-- Coverage Report -->
                <div class="mt-4 p-3 bg-gray-900 rounded">
                  <div class="text-sm text-gray-400 mb-2">Code Coverage</div>
                  <div class="space-y-2 text-xs">
                    <div class="flex justify-between">
                      <span>Lines</span>
                      <span class="text-green-400">85.7%</span>
                    </div>
                    <div class="flex justify-between">
                      <span>Functions</span>
                      <span class="text-yellow-400">75.0%</span>
                    </div>
                    <div class="flex justify-between">
                      <span>Branches</span>
                      <span class="text-red-400">60.0%</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Rahim AI Assistant Panel (Floating) -->
    <div
      id="aiAssistant"
      class="fixed bottom-4 right-4 w-80 ai-panel rounded-lg hidden bg-gray-800 border border-purple-600 shadow-lg flex flex-col overflow-y-scroll m-4"
    >
      <div class="p-4 overflow-y-auto flex-1">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center space-x-2">
            <div
              class="w-8 h-8 rahim-avatar rounded-full flex items-center justify-center"
            >
              <i class="fas fa-robot text-white text-sm"></i>
            </div>
            <div>
              <span class="text-sm font-semibold text-purple-400">Rahim</span>
              <div class="text-xs text-gray-400">Backend Mentor AI</div>
            </div>
            <div
              class="w-2 h-2 bg-green-500 rounded-full animate-pulse"
              title="Online"
            ></div>
          </div>
          <div class="flex space-x-2">
            <button
              onclick="minimizeAI()"
              class="text-gray-400 hover:text-white text-xs"
            >
              <i class="fas fa-minus"></i>
            </button>
            <button onclick="toggleAI()" class="text-gray-400 hover:text-white">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>

        <!-- AI Chat -->
        <div class="space-y-3 mb-4 max-h-full overflow-y-auto" id="aiChat">
          <div class="flex items-start space-x-2">
            <div
              class="w-6 h-6 rahim-avatar rounded-full flex items-center justify-center"
            >
              <i class="fas fa-robot text-white text-xs"></i>
            </div>
            <div
              class="flex-1 bg-gray-900 rounded-lg p-2 text-sm text-gray-300"
            >
               Hey there, fellow developer! I'm Rahim, your gaming-focused
              Backend Mentor AI. Think of me as your coding co-op partner! I
              specialize in Node.js, Express, JWT auth, and API security -
              perfect for building game backends, leaderboards, user systems,
              and multiplayer APIs. Ready to level up your backend skills? Let's
              code some epic systems! 
            </div>
          </div>
        </div>

        <!-- AI Input -->
        <div class="flex space-x-2 mb-3">
          <input
            type="text"
            id="aiInput"
            class="flex-1 bg-gray-700 text-white text-sm rounded px-3 py-2 border border-gray-600"
            placeholder="Ask Rahim anything..."
            onkeypress="handleAIInput(event)"
          />
          <button
            onclick="sendAIMessage()"
            class="bg-purple-600 hover:bg-purple-700 px-3 py-2 rounded text-white"
          >
            <i class="fas fa-paper-plane text-sm"></i>
          </button>
        </div>

        <!-- Quick Actions -->
        <div class="flex flex-wrap gap-2">
          <button
            onclick="askAI('Review my game backend code like a pro gamer')"
            class="bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded text-xs text-gray-300"
          >
             Code Review
          </button>
          <button
            onclick="askAI('Help me debug this like we are speedrunning')"
            class="bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded text-xs text-gray-300"
          >
             Debug Boss
          </button>
          <button
            onclick="askAI('What are the best practices for game backend security?')"
            class="bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded text-xs text-gray-300"
          >
             Security Guide
          </button>
          <button
            onclick="askAI('Generate epic tests for my game API')"
            class="bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded text-xs text-gray-300"
          >
             Test Generator
          </button>
          <button
            onclick="askAI('How can I optimize this for multiplayer gaming?')"
            class="bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded text-xs text-gray-300"
          >
             Performance
          </button>
          <button
            onclick="askAI('Help me build a leaderboard system')"
            class="bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded text-xs text-gray-300"
          >
             Leaderboards
          </button>
        </div>
      </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar h-6 flex items-center justify-between px-4 text-xs">
      <div class="flex items-center space-x-4">
        <span id="cursorPosition">Ln 23, Col 15</span>
        <select
          id="languageSelect"
          onchange="changeLanguage()"
          class="bg-transparent text-white text-xs border-none outline-none"
        ></select>
        <span>UTF-8</span>
        <span id="fileSize">2.1KB</span>
      </div>
      <div class="flex items-center space-x-4">
        <span class="flex items-center space-x-1">
          <i class="fas fa-wifi"></i>
          <span>Connected</span>
        </span>
        <span id="gitBranch"> <i class="fab fa-git-alt mr-1"></i>main </span>
        <span class="flex items-center space-x-1">
          <i class="fas fa-robot"></i>
          <span>Rahim Ready</span>
        </span>
        <span>Backend Mentor</span>
      </div>
    </div>

    <script>
      // Global Variables
      const GEMINI_API_KEY = "AIzaSyAq6QATs5YOVtHM46Lp9cXVY1c9d1qmr8g";
      const GEMINI_API_URL =
        "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent";

      let editor;
      let currentFile = null;
      let currentProject = "rest-api-auth";
      let selectedTemplate = "rest-api";
      let startTime = Date.now();
      let timerInterval;
      let openFiles = new Set();
      let fileSystem = { type: "folder", name: "", children: {} };
      let foldersOpen = new Set(["/"]);
      let isAutoSaveEnabled = true;
      let terminalHistory = [];
      let terminalHistoryIndex = -1;
      let currentWorkingDirectory = "/";
      let aiConversationHistory = [];
      let isResizing = false;
      let resizeTarget = null;

      // Project Templates
      const projectTemplates = {
        "rest-api": {
          name: "REST API Authentication",
          description: "Express.js server with JWT authentication",
          files: {
            "server.js": `const express = require('express');
const jwt = require('jsonwebtoken');
const bcrypt = require('bcrypt');
const app = express();

app.use(express.json());

// Sample user data (in production, use a database)
const users = [
    {
        id: 1,
        email: 'user@example.com',
        password: '$2b$10$...' // hashed password
    }
];

// JWT Secret (should be in environment variables)
const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';

// Login endpoint
app.post('/api/auth/login', async (req, res) => {
    const { email, password } = req.body;
    
    // Find user
    const user = users.find(u => u.email === email);
    if (!user) {
        return res.status(401).json({ error: 'Invalid credentials' });
    }
    
    // Verify password
    const validPassword = await bcrypt.compare(password, user.password);
    if (!validPassword) {
        return res.status(401).json({ error: 'Invalid credentials' });
    }
    
    // Generate JWT token
    const token = jwt.sign(
        { userId: user.id, email: user.email },
        JWT_SECRET,
        { expiresIn: '24h' }
    );
    
    res.json({
        success: true,
        token,
        user: { id: user.id, email: user.email }
    });
});

// Protected route middleware
const authenticateToken = (req, res, next) => {
    const authHeader = req.headers['authorization'];
    const token = authHeader && authHeader.split(' ')[1];
    
    if (!token) {
        return res.status(401).json({ error: 'Access token required' });
    }
    
    // TODO: Add JWT verification logic here
    // Hint: Use jwt.verify() with proper error handling
    
    next();
};

// Protected route example
app.get('/api/profile', authenticateToken, (req, res) => {
    res.json({ message: 'This is a protected route', user: req.user });
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    console.log(\`Server running on port \${PORT}\`);
});`,
            "package.json": `{
  "name": "rest-api-auth",
  "version": "1.0.0",
  "description": "REST API with JWT Authentication",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "test": "jest"
  },
  "dependencies": {
    "express": "^4.18.2",
    "jsonwebtoken": "^9.0.0",
    "bcrypt": "^5.1.0",
    "dotenv": "^16.0.3"
  },
  "devDependencies": {
    "nodemon": "^2.0.22",
    "jest": "^29.5.0"
  }
}`,
            ".env": `JWT_SECRET=your-super-secret-jwt-key-here
PORT=3000
NODE_ENV=development`,
            "README.md": `# REST API Authentication

Build a secure REST API with JWT authentication.

## Getting Started
\`\`\`bash
npm install
npm run dev
\`\`\`

## Challenge Tasks
- [ ] Complete the authenticateToken middleware
- [ ] Add proper error handling
- [ ] Implement password hashing
- [ ] Create comprehensive tests`,
          },
        },
        graphql: {
          name: "GraphQL API",
          description: "Apollo Server with TypeScript",
          files: {
            "server.ts": `import { ApolloServer } from 'apollo-server-express';
import { buildSchema } from 'type-graphql';
import express from 'express';
import { UserResolver } from './resolvers/UserResolver';

async function bootstrap() {
    const schema = await buildSchema({
        resolvers: [UserResolver],
    });

    const server = new ApolloServer({ schema });
    const app = express();

    await server.start();
    server.applyMiddleware({ app });

    const PORT = process.env.PORT || 4000;
    app.listen(PORT, () => {
        console.log(\`Server running on http://localhost:\${PORT}\${server.graphqlPath}\`);
    });
}

bootstrap();`,
            "package.json": `{
  "name": "graphql-api",
  "version": "1.0.0",
  "description": "GraphQL API with Apollo Server",
  "main": "dist/server.js",
  "scripts": {
    "start": "node dist/server.js",
    "dev": "ts-node-dev --respawn --transpile-only src/server.ts",
    "build": "tsc"
  },
  "dependencies": {
    "apollo-server-express": "^3.12.0",
    "type-graphql": "^1.1.1",
    "express": "^4.18.2"
  },
  "devDependencies": {
    "typescript": "^4.9.5",
    "ts-node-dev": "^2.0.0"
  }
}`,
          },
        },
        microservices: {
          name: "Microservices Architecture",
          description: "Docker + Kubernetes setup",
          files: {
            "docker-compose.yml": `version: '3.8'
services:
  api-gateway:
    build: ./api-gateway
    ports:
      - "3000:3000"
    depends_on:
      - user-service
      - product-service
      
  user-service:
    build: ./user-service
    ports:
      - "3001:3001"
    environment:
      - DB_HOST=user-db
      
  product-service:
    build: ./product-service
    ports:
      - "3002:3002"`,
            "README.md": `# Microservices Architecture

Build scalable microservices with Docker and Kubernetes.

## Services
- API Gateway
- User Service
- Product Service

## Getting Started
\`\`\`bash
docker-compose up
\`\`\``,
          },
        },
        "realtime-chat": {
          name: "Real-time Chat Application",
          description: "Socket.io + Redis",
          files: {
            "server.js": `const express = require('express');
const http = require('http');
const socketIo = require('socket.io');
const redis = require('redis');

const app = express();
const server = http.createServer(app);
const io = socketIo(server);

// Redis client for message persistence
const redisClient = redis.createClient();

io.on('connection', (socket) => {
    console.log('User connected:', socket.id);
    
    socket.on('join-room', (room) => {
        socket.join(room);
        socket.to(room).emit('user-joined', socket.id);
    });
    
    socket.on('send-message', (data) => {
        // Save message to Redis
        redisClient.lpush(\`messages:\${data.room}\`, JSON.stringify(data));
        
        // Broadcast to room
        socket.to(data.room).emit('receive-message', data);
    });
    
    socket.on('disconnect', () => {
        console.log('User disconnected:', socket.id);
    });
});

const PORT = process.env.PORT || 3000;
server.listen(PORT, () => {
    console.log(\`Chat server running on port \${PORT}\`);
});`,
            "package.json": `{
  "name": "realtime-chat",
  "version": "1.0.0",
  "description": "Real-time chat with Socket.io",
  "main": "server.js",
  "dependencies": {
    "express": "^4.18.2",
    "socket.io": "^4.7.2",
    "redis": "^4.6.7"
  }
}`,
          },
        },
        ecommerce: {
          name: "E-commerce API",
          description: "Stripe + PostgreSQL",
          files: {
            "server.js": `const express = require('express');
const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);
const { Pool } = require('pg');

const app = express();
app.use(express.json());

// PostgreSQL connection
const pool = new Pool({
    connectionString: process.env.DATABASE_URL
});

// Create payment intent
app.post('/api/payments/create-intent', async (req, res) => {
    try {
        const { amount, currency = 'usd' } = req.body;
        
        const paymentIntent = await stripe.paymentIntents.create({
            amount: amount * 100, // Convert to cents
            currency,
        });
        
        res.json({
            clientSecret: paymentIntent.client_secret
        });
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});

// Get products
app.get('/api/products', async (req, res) => {
    try {
        const result = await pool.query('SELECT * FROM products');
        res.json(result.rows);
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    console.log(\`E-commerce API running on port \${PORT}\`);
});`,
            "package.json": `{
  "name": "ecommerce-api",
  "version": "1.0.0",
  "description": "E-commerce API with Stripe",
  "main": "server.js",
  "dependencies": {
    "express": "^4.18.2",
    "stripe": "^12.9.0",
    "pg": "^8.11.0"
  }
}`,
          },
        },
        django: {
          name: "Django API",
          description: "Python Django REST framework",
          files: {
            "manage.py": `#!/usr/bin/env python
import os
import sys

if __name__ == "__main__":
    os.environ.setdefault("DJANGO_SETTINGS_MODULE", "project.settings")
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)`,
            "project/settings.py": `# Django settings
import os

BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))

SECRET_KEY = 'your-secret-key'

DEBUG = True

ALLOWED_HOSTS = []

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',
    'api',
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'project.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'project.wsgi.application'

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
    }
}

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_L10N = True

USE_TZ = True

STATIC_URL = '/static/'

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework.authentication.BasicAuthentication',
        'rest_framework.authentication.SessionAuthentication',
    )
}`,
            "project/urls.py": `from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/', include('api.urls')),
]`,
            "api/models.py": `from django.db import models

class User(models.Model):
    email = models.EmailField(unique=True)
    password = models.CharField(max_length=128)
    created_at = models.DateTimeField(auto_now_add=True)`,
            "api/views.py": `from rest_framework import generics
from .models import User
from .serializers import UserSerializer

class UserListCreate(generics.ListCreateAPIView):
    queryset = User.objects.all()
    serializer_class = UserSerializer`,
            "api/serializers.py": `from rest_framework import serializers
from .models import User

class UserSerializer(serializers.ModelSerializer):
    class Meta:
        model = User
        fields = '__all__'`,
            "api/urls.py": `from django.urls import path
from .views import UserListCreate

urlpatterns = [
    path('users/', UserListCreate.as_view(), name='user-list-create'),
]`,
            "requirements.txt": `django
djangorestframework`,
          },
        },
        rust: {
          name: "Rust API",
          description: "Actix-web framework",
          files: {
            "Cargo.toml": `[package]
name = "rust-api"
version = "0.1.0"
edition = "2021"

[dependencies]
actix-web = "4"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
env_logger = "0.10"`,
            "src/main.rs": `use actix_web::{get, post, web, App, HttpResponse, HttpServer, Responder};
use serde::Deserialize;

#[derive(Deserialize)]
struct Info {
    name: String,
}

#[get("/")]
async fn hello() -> impl Responder {
    HttpResponse::Ok().body("Hello world!")
}

#[post("/echo")]
async fn echo(req_body: String) -> impl Responder {
    HttpResponse::Ok().body(req_body)
}

#[actix_web::main]
async fn main() -> std::io::Result<()> {
    env_logger::init_from_env(env_logger::Env::new().default_filter_or("info"));

    HttpServer::new(|| {
        App::new()
            .service(hello)
            .service(echo)
    })
    .bind(("127.0.0.1", 8080))?
    .run()
    .await
}`,
          },
        },
        laravel: {
          name: "Laravel API",
          description: "PHP Laravel framework",
          files: {
            "composer.json": `{
  "name": "laravel/laravel-api",
  "type": "project",
  "description": "Laravel API project",
  "require": {
    "php": "^8.1",
    "laravel/framework": "^10.0"
  }
}`,
            "app/Http/Controllers/UserController.php": `<?php

namespace App\\Http\\Controllers;

use Illuminate\\Http\\Request;

class UserController extends Controller
{
    public function index()
    {
        return response()->json(['message' => 'Users list']);
    }
}`,
            "routes/api.php": `<?php

use Illuminate\\Http\\Request;
use App\\Http\\Controllers\\UserController;

Route::get('/users', [UserController::class, 'index']);`,
          },
        },
        firebase: {
          name: "Firebase Backend",
          description: "Node.js with Firebase",
          files: {
            "index.js": `const admin = require('firebase-admin');

admin.initializeApp({
  credential: admin.credential.cert('path/to/serviceAccountKey.json')
});

const db = admin.firestore();

async function addData() {
  const docRef = db.collection('users').doc('alovelace');

  await docRef.set({
    first: 'Ada',
    last: 'Lovelace',
    born: 1815
  });

  console.log('Document written!');
}

addData();`,
            "package.json": `{
  "name": "firebase-backend",
  "version": "1.0.0",
  "description": "Node.js with Firebase",
  "main": "index.js",
  "dependencies": {
    "firebase-admin": "^12.0.0"
  }
}`,
          },
        },
        blank: {
          name: "Blank Project",
          description: "Start from scratch",
          files: {
            "index.js": `// Welcome to your new project!
// Start building something amazing...

console.log('Hello, Backend Mentor!');`,
            "package.json": `{
  "name": "my-project",
  "version": "1.0.0",
  "description": "A new Backend Mentor project",
  "main": "index.js",
  "scripts": {
    "start": "node index.js"
  }
}`,
          },
        },
      };

      // Initialize Monaco Editor
      require.config({
        paths: { vs: "https://unpkg.com/monaco-editor@0.44.0/min/vs" },
      });
      require(["vs/editor/editor.main"], function () {
        editor = monaco.editor.create(document.getElementById("editor"), {
          value: "",
          language: "javascript",
          theme: "vs-dark",
          fontSize: 14,
          fontFamily: "JetBrains Mono",
          minimap: { enabled: true },
          scrollBeyondLastLine: true,
          automaticLayout: true,
          suggestOnTriggerCharacters: true,
          quickSuggestions: true,
          wordWrap: "on",
          lineNumbers: "on",
          renderWhitespace: "selection",
          bracketPairColorization: { enabled: true },
          guides: {
            bracketPairs: true,
            indentation: true,
          },
        });
        // Editor options
        editor.updateOptions({
          autoClosingBrackets: "always", // auto close brackets
          autoClosingQuotes: "always", // auto close quotes
          autoIndent: "full", // smart indenting
          tabSize: 4, // indentation spaces
          insertSpaces: true, // use spaces instead of tabs
          detectIndentation: true, // detect from file
          formatOnType: true, // auto-format on `;`, `}`
          formatOnPaste: true, // auto-format pasted code
          suggestSelection: "first", // auto-select first suggestion
        });
        editor.updateOptions({
          theme: "vs-dark", // "vs", "hc-black", or custom themes
          fontSize: 16, // Adjust font size
          fontLigatures: true, // Enable ligatures if your font supports them
          cursorStyle: "line", // "line", "block", "underline"
          cursorBlinking: "smooth", // "blink", "smooth", "phase", "expand"
          renderLineHighlight: "all", // Highlight current line (line + gutter)
          roundedSelection: false, // Square/round selection
          smoothScrolling: true, // Smooth scroll
        });

        // Editor event listeners
        editor.onDidChangeModelContent(() => {
          if (isAutoSaveEnabled && currentFile) {
            setContent(currentFile, editor.getValue());
            markFileAsModified(currentFile, true);
            saveState();
          }
          updateStatusBar();

          // Check for AI suggestions
          setTimeout(() => {
            const code = editor.getValue();
            if (
              code.includes("jwt.verify") &&
              !code.includes("try") &&
              !code.includes("catch")
            ) {
              showAISuggestion();
            }
          }, 1000);
        });

        editor.onDidChangeCursorPosition(() => {
          updateStatusBar();
        });

        // Add keyboard shortcuts
        editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyS, () => {
          saveFile();
        });

        editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyF, () => {
          showFindWidget();
        });

        editor.addCommand(monaco.KeyCode.F5, () => {
          runCode();
        });

        editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.Slash, () => {
          toggleAI();
        });

        editor.addCommand(
          monaco.KeyMod.CtrlCmd | monaco.KeyMod.Shift | monaco.KeyCode.KeyP,
          () => {
            showCommandPalette();
          }
        );

        // Context menu
        editor.onContextMenu((e) => {
          showContextMenu(e.event.posx, e.event.posy);
        });

        // Initialize with default project
        loadState();
      });

      // Initialize application
      function init() {
        updateTimer();
        timerInterval = setInterval(updateTimer, 1000);

        // Add global event listeners
        document.addEventListener("keydown", (e) => {
          if (e.ctrlKey || e.metaKey) {
            switch (e.key) {
              case ",":
                e.preventDefault();
                openSettings();
                break;
              case "/":
                e.preventDefault();
                toggleAI();
                break;
              case "p":
                if (e.shiftKey) {
                  e.preventDefault();
                  showCommandPalette();
                }
                break;
              case "n":
                e.preventDefault();
                showNewProjectModal();
                break;
            }
          }

          if (e.key === "Escape") {
            hideCommandPalette();
            closeFindWidget();
            hideContextMenu();
            closeCreateFileModal();
            closeCreateFolderModal();
          }
        });

        // Add click outside listeners
        document.addEventListener("click", (e) => {
          if (!e.target.closest("#commandPalette")) {
            hideCommandPalette();
          }
          if (!e.target.closest("#contextMenu")) {
            hideContextMenu();
          }
        });

        // Add resize listeners
        document.addEventListener("mousemove", handleResize);
        document.addEventListener("mouseup", stopResize);

        // Focus terminal input when clicking on terminal
        document.getElementById("terminalOutput").onclick = () => {
          document.getElementById("terminalInput").focus();
        };
      }

      // State Persistence
      function saveState() {
        localStorage.setItem("fileSystem", JSON.stringify(fileSystem));
        localStorage.setItem(
          "foldersOpen",
          JSON.stringify(Array.from(foldersOpen))
        );
        localStorage.setItem("currentProject", currentProject);
        localStorage.setItem(
          "openFiles",
          JSON.stringify(Array.from(openFiles))
        );
        localStorage.setItem("currentFile", currentFile);
        localStorage.setItem(
          "currentWorkingDirectory",
          currentWorkingDirectory
        );
      }

      function loadState() {
        if (localStorage.getItem("fileSystem")) {
          fileSystem = JSON.parse(localStorage.getItem("fileSystem"));
          foldersOpen = new Set(
            JSON.parse(localStorage.getItem("foldersOpen"))
          );
          currentProject =
            localStorage.getItem("currentProject") || "rest-api-auth";
          openFiles = new Set(JSON.parse(localStorage.getItem("openFiles")));
          currentFile = localStorage.getItem("currentFile");
          currentWorkingDirectory =
            localStorage.getItem("currentWorkingDirectory") || "/";
          updateFileTree();
          openFiles.forEach((f) => addTab(f));
          if (currentFile) openFile(currentFile);
          document.getElementById("currentProjectName").textContent =
            currentProject;
          updateTerminalPrompt();
        } else {
          loadProject("rest-api");
        }
      }

      // File System Utilities
      function getNode(path) {
        const parts = path.split("/").filter((p) => p);
        let current = fileSystem;
        for (let part of parts) {
          if (!current.children || !current.children[part]) return null;
          current = current.children[part];
        }
        return current;
      }

      function getContent(path) {
        const node = getNode(path);
        return node && node.type === "file" ? node.content : null;
      }

      function setContent(path, content) {
        const node = getNode(path);
        if (node && node.type === "file") {
          node.content = content;
        }
      }

      function addFile(path, content = "") {
        const parts = path.split("/").filter((p) => p);
        let current = fileSystem;
        for (let i = 0; i < parts.length - 1; i++) {
          const part = parts[i];
          if (!current.children[part]) {
            current.children[part] = {
              type: "folder",
              name: part,
              children: {},
            };
          } else if (current.children[part].type !== "folder") {
            return false;
          }
          current = current.children[part];
        }
        const fileName = parts[parts.length - 1];
        if (current.children[fileName]) return false;
        current.children[fileName] = { type: "file", name: fileName, content };
        return true;
      }

      function addFolder(path) {
        const parts = path.split("/").filter((p) => p);
        let current = fileSystem;
        for (let i = 0; i < parts.length; i++) {
          const part = parts[i];
          if (!current.children[part]) {
            current.children[part] = {
              type: "folder",
              name: part,
              children: {},
            };
          } else if (current.children[part].type !== "folder") {
            return false;
          }
          current = current.children[part];
        }
        return true;
      }

      function removePath(path) {
        const parts = path.split("/").filter((p) => p);
        let current = fileSystem;
        for (let i = 0; i < parts.length - 1; i++) {
          const part = parts[i];
          if (!current.children[part]) return false;
          current = current.children[part];
        }
        const name = parts[parts.length - 1];
        if (!current.children[name]) return false;
        if (
          current.children[name].type === "folder" &&
          Object.keys(current.children[name].children).length > 0
        ) {
          return false; // not empty
        }
        delete current.children[name];
        return true;
      }

      function copyPath(source, dest) {
        const srcNode = getNode(source);
        if (!srcNode) return false;

        const destParts = dest.split("/").filter((p) => p);
        let current = fileSystem;
        for (let i = 0; i < destParts.length - 1; i++) {
          const part = destParts[i];
          if (!current.children[part]) {
            current.children[part] = {
              type: "folder",
              name: part,
              children: {},
            };
          } else if (current.children[part].type !== "folder") {
            return false;
          }
          current = current.children[part];
        }
        const destName = destParts[destParts.length - 1];
        if (current.children[destName]) return false;

        current.children[destName] = JSON.parse(JSON.stringify(srcNode));
        current.children[destName].name = destName;
        return true;
      }

      function movePath(source, dest) {
        if (copyPath(source, dest)) {
          removePath(source);
          return true;
        }
        return false;
      }

      function getChildren(path) {
        const node = getNode(path);
        if (!node || node.type !== "folder") return [];
        return Object.keys(node.children)
          .sort()
          .map((name) => ({ name, type: node.children[name].type }));
      }

      function resolvePath(base, rel) {
        if (rel.startsWith("/")) return rel;
        let path = base.endsWith("/") ? base + rel : base + "/" + rel;
        const parts = path.split("/").filter((p) => p !== "");
        const resolved = [];
        for (let part of parts) {
          if (part === "..") {
            if (resolved.length) resolved.pop();
          } else if (part !== ".") {
            resolved.push(part);
          }
        }
        return "/" + resolved.join("/");
      }

      // Project Management
      function showNewProjectModal() {
        document.getElementById("newProjectModal").classList.remove("hidden");
      }

      function closeNewProjectModal() {
        document.getElementById("newProjectModal").classList.add("hidden");
      }

      function selectTemplate(templateId) {
        selectedTemplate = templateId;

        // Update UI to show selected template
        document.querySelectorAll(".project-card").forEach((card) => {
          card.classList.remove("border-blue-500");
        });

        event.currentTarget.classList.add("border-blue-500");

        // Update project name based on template
        const template = projectTemplates[templateId];
        if (template) {
          document.getElementById("projectName").value = templateId;
          document.getElementById("projectDescription").value =
            template.description;
        }
      }

      function createNewProject() {
        const projectName = document.getElementById("projectName").value.trim();
        const description = document
          .getElementById("projectDescription")
          .value.trim();
        const nodeVersion = document.getElementById("nodeVersion").value;
        const packageManager = document.getElementById("packageManager").value;

        // Get additional options
        const includeDocker = document.getElementById("includeDocker").checked;
        const includeTests = document.getElementById("includeTests").checked;
        const includeESLint = document.getElementById("includeESLint").checked;
        const includeTypeScript =
          document.getElementById("includeTypeScript").checked;
        const includeCI = document.getElementById("includeCI").checked;
        const includeSwagger =
          document.getElementById("includeSwagger").checked;

        if (!projectName) {
          showNotification("Please enter a project name", "error");
          return;
        }

        showNotification("Creating new project...", "info");

        setTimeout(() => {
          currentProject = projectName;
          document.getElementById("currentProjectName").textContent =
            projectName;

          // Load template project with options
          loadProject(selectedTemplate, {
            name: projectName,
            description,
            nodeVersion,
            packageManager,
            includeDocker,
            includeTests,
            includeESLint,
            includeTypeScript,
            includeCI,
            includeSwagger,
          });

          closeNewProjectModal();
          showNotification(
            `Project "${projectName}" created successfully!`,
            "success"
          );

          // Reset terminal for new project
          clearTerminal();
          const terminal = document.getElementById("terminalOutput");
          terminal.innerHTML += `<div class="text-blue-400">[INFO] Project: ${projectName}</div>`;
          terminal.innerHTML += `<div class="text-green-400">[SUCCESS] Environment initialized</div>`;
          terminal.innerHTML += `<div class="text-purple-400">[AI] Rahim is ready to help with your new project!</div>`;

          currentWorkingDirectory = "/";
          updateTerminalPrompt();
          saveState();
        }, 2000);
      }

      // Create File/Folder Modals
      function showCreateFileModal() {
        document.getElementById("createFileModal").classList.remove("hidden");
        document.getElementById("filePathInput").focus();
      }

      function closeCreateFileModal() {
        document.getElementById("createFileModal").classList.add("hidden");
        document.getElementById("filePathInput").value = "";
      }

      function confirmCreateFile() {
        const path = document.getElementById("filePathInput").value.trim();
        if (path && addFile(resolvePath(currentWorkingDirectory, path))) {
          updateFileTree();
          openFile(resolvePath(currentWorkingDirectory, path));
          showNotification(`Created file ${path}`, "success");
          saveState();
        } else if (path) {
          showNotification(`Failed to create file ${path}`, "error");
        }
        closeCreateFileModal();
      }

      function showCreateFolderModal() {
        document.getElementById("createFolderModal").classList.remove("hidden");
        document.getElementById("folderPathInput").focus();
      }

      function closeCreateFolderModal() {
        document.getElementById("createFolderModal").classList.add("hidden");
        document.getElementById("folderPathInput").value = "";
      }

      function confirmCreateFolder() {
        const path = document.getElementById("folderPathInput").value.trim();
        if (path && addFolder(resolvePath(currentWorkingDirectory, path))) {
          updateFileTree();
          showNotification(`Created folder ${path}`, "success");
          saveState();
        } else if (path) {
          showNotification(`Failed to create folder ${path}`, "error");
        }
        closeCreateFolderModal();
      }

      function loadProject(templateId, options = {}) {
        const template = projectTemplates[templateId];
        if (!template) return;

        // Clear existing files
        fileSystem = { type: "folder", name: "", children: {} };
        openFiles.clear();
        currentFile = null;

        // Load template files
        Object.entries(template.files).forEach(([filename, content]) => {
          let processedContent = content;

          // Process content based on options
          if (
            (options.name && filename === "package.json") ||
            filename === "composer.json" ||
            filename === "Cargo.toml"
          ) {
            processedContent = processedContent.replace(
              /"name": "[^"]*"/,
              `"name": "${options.name}"`
            );
          }

          if (options.description && filename === "package.json") {
            processedContent = processedContent.replace(
              /"description": "[^"]*"/,
              `"description": "${options.description}"`
            );
          }

          addFile(filename, processedContent);
        });

        // Add optional files and modifications
        let pkgPath =
          Object.keys(template.files).find(
            (f) =>
              f.endsWith("package.json") ||
              f.endsWith("composer.json") ||
              f.endsWith("Cargo.toml")
          ) || "package.json";
        let pkgJson = getContent(pkgPath) || "{}";
        let pkg = JSON.parse(pkgJson);

        if (options.includeTypeScript) {
          // Rename .js to .ts
          let serverFile = Object.keys(template.files).find((f) =>
            f.endsWith(".js")
          );
          if (serverFile) {
            let tsContent = getContent(serverFile)
              .replace(/require\(/g, "import ")
              .replace(/ = require\(/g, " = await import(")
              .replace(/'\);/g, "').then(m => m.default);"); // Basic conversion
            addFile(serverFile.replace(".js", ".ts"), tsContent);
            removePath(serverFile);
            pkg.main = "dist/" + serverFile.replace(".js", ".js");
            pkg.scripts.build = "tsc";
          }
          pkg.devDependencies = {
            ...(pkg.devDependencies || {}),
            typescript: "^5.0.0",
          };
          addFile(
            "tsconfig.json",
            JSON.stringify(
              {
                compilerOptions: {
                  target: "es6",
                  module: "commonjs",
                  strict: true,
                  outDir: "dist",
                },
              },
              null,
              2
            )
          );
        }

        if (options.includeDocker) {
          addFile(
            "Dockerfile",
            `FROM node:${options.nodeVersion}

WORKDIR /app

COPY package*.json .

RUN ${options.packageManager} install

COPY . .

CMD ["${options.packageManager}", "run", "start"]`
          );
        }

        if (options.includeTests) {
          pkg.devDependencies = {
            ...(pkg.devDependencies || {}),
            jest: "^29.5.0",
          };
          pkg.scripts.test = "jest";
          addFile(
            "tests/server.test.js",
            `describe('Server', () => {
  it('should start', () => {
    expect(true).toBe(true);
  });
});`
          );
        }

        if (options.includeESLint) {
          pkg.devDependencies = {
            ...(pkg.devDependencies || {}),
            eslint: "^8.0.0",
            prettier: "^2.0.0",
            "eslint-config-prettier": "^8.0.0",
          };
          pkg.scripts.lint = "eslint .";
          addFile(
            ".eslintrc.json",
            JSON.stringify(
              {
                extends: ["prettier"],
                rules: {},
              },
              null,
              2
            )
          );
          addFile(
            ".prettierrc",
            JSON.stringify(
              {
                semi: true,
                singleQuote: true,
              },
              null,
              2
            )
          );
        }

        if (options.includeCI) {
          addFile(
            ".github/workflows/ci.yml",
            `name: CI
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install dependencies
        run: ${options.packageManager} install
      - name: Run tests
        run: ${options.packageManager} test`
          );
        }

        if (options.includeSwagger) {
          pkg.dependencies = {
            ...(pkg.dependencies || {}),
            "swagger-ui-express": "^4.3.0",
          };
          // Add to server.js or ts
          let serverFile =
            Object.keys(template.files).find(
              (f) => f.endsWith("server.js") || f.endsWith("server.ts")
            ) || "server.js";
          let serverContent = getContent(serverFile) || "";
          serverContent += `
const swaggerUi = require('swagger-ui-express');
const swaggerDocument = { openapi: '3.0.0', info: { title: '${options.name}', version: '1.0.0' } };
app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(swaggerDocument));`;
          setContent(serverFile, serverContent);
        }

        setContent(pkgPath, JSON.stringify(pkg, null, 2));

        // Update file tree
        updateFileTree();

        // Open first file
        const firstFile = Object.keys(template.files)[0];
        if (firstFile) {
          openFile(firstFile);
        }

        // Update working directory
        currentWorkingDirectory = "/";
        saveState();
      }

      function updateFileTree() {
        const fileTreeContent = document.getElementById("fileTreeContent");
        fileTreeContent.innerHTML = "";

        const rootPath = "/";
        const isRootOpen = foldersOpen.has(rootPath);

        const rootItem = document.createElement("div");
        rootItem.className = "file-tree-item p-2 rounded cursor-pointer";
        rootItem.onclick = () => toggleFolder(rootPath);
        rootItem.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas ${
                      isRootOpen ? "fa-folder-open" : "fa-folder"
                    } text-blue-400 text-sm"></i>
                    <span class="text-sm text-gray-300">${currentProject}</span>
                </div>
            `;
        fileTreeContent.appendChild(rootItem);

        if (isRootOpen) {
          const filesContainer = document.createElement("div");
          filesContainer.className = "ml-4 space-y-1";
          renderTree(filesContainer, fileSystem, rootPath);
          fileTreeContent.appendChild(filesContainer);
        }
      }

      function renderTree(container, node, path) {
        const sortedKeys = Object.keys(node.children).sort((a, b) => {
          const aType = node.children[a].type;
          const bType = node.children[b].type;
          if (aType === "folder" && bType !== "folder") return -1;
          if (aType !== "folder" && bType === "folder") return 1;
          return a.localeCompare(b);
        });

        sortedKeys.forEach((name) => {
          const child = node.children[name];
          const fullPath = path + name + (child.type === "folder" ? "/" : "");
          const item = document.createElement("div");
          item.className = "file-tree-item p-2 rounded cursor-pointer";

          if (child.type === "folder") {
            const isOpen = foldersOpen.has(fullPath);
            item.onclick = () => toggleFolder(fullPath);
            item.innerHTML = `
                        <div class="flex items-center space-x-2">
                            <i class="fas ${
                              isOpen ? "fa-folder-open" : "fa-folder"
                            } text-blue-400 text-sm"></i>
                            <span class="text-sm text-gray-300">${name}</span>
                        </div>
                    `;
            container.appendChild(item);

            if (isOpen) {
              const subContainer = document.createElement("div");
              subContainer.className = "ml-4 space-y-1";
              renderTree(subContainer, child, fullPath);
              container.appendChild(subContainer);
            }
          } else {
            const isActive = fullPath === currentFile;
            item.onclick = () => openFile(fullPath);
            item.oncontextmenu = (e) => showFileContextMenu(e, fullPath);
            item.innerHTML = `
                        <div class="flex items-center space-x-2">
                            ${getFileIcon(name)}
                            <span class="text-sm ${
                              isActive ? "text-white" : "text-gray-300"
                            }">${name}</span>
                        </div>
                    `;
            if (isActive) {
              item.classList.add("active");
            }
            container.appendChild(item);
          }
        });
      }

      function toggleFolder(path) {
        if (foldersOpen.has(path)) {
          foldersOpen.delete(path);
        } else {
          foldersOpen.add(path);
        }
        updateFileTree();
        saveState();
      }

      // File Operations
      function openFile(path) {
        // Save current file content
        if (editor && currentFile) {
          setContent(currentFile, editor.getValue());
          saveState();
        }

        currentFile = path;

        // Update active file in tree
        updateFileTree(); // To highlight active

        // Load file content
        const content = getContent(path) || "";
        if (editor) {
          editor.setValue(content);
          editor.setScrollTop(0);

          // Set language based on file extension
          const filename = path.split("/").pop();
          const extension = filename.split(".").pop();
          const languageMap = {
            js: "javascript",
            ts: "typescript",
            json: "json",
            md: "markdown",
            env: "shell",
            yml: "yaml",
            yaml: "yaml",
            html: "html",
            css: "css",
            py: "python",
            c: "c",
            cpp: "cpp",
            java: "java",
            go: "go",
            rs: "rust",
            php: "php",
            rb: "ruby",
            swift: "swift",
            kt: "kotlin",
            scala: "scala",
          };
          const language = languageMap[extension] || "plaintext";
          monaco.editor.setModelLanguage(editor.getModel(), language);

          populateLanguageSelect(language);
        }

        // Add to open tabs if not already open
        if (!openFiles.has(path)) {
          addTab(path);
          openFiles.add(path);
        }

        // Update active tab
        updateActiveTab(path);

        showNotification(`Opened ${path}`, "info");
        updateStatusBar();
        saveState();
      }

      function addTab(path) {
        const tabsContainer = document.getElementById("openTabs");
        const filename = path.split("/").pop();
        const tab = document.createElement("div");
        tab.className =
          "px-4 py-2 text-sm flex items-center space-x-2 border-r border-gray-700 text-gray-400 hover:text-white cursor-pointer";
        tab.setAttribute("data-file", path);
        tab.onclick = () => openFile(path);

        const icon = getFileIcon(filename);

        tab.innerHTML = `
                ${icon}
                <span>${filename}</span>
                <button onclick="closeTab('${path}'); event.stopPropagation();" class="text-gray-400 hover:text-white ml-2">
                    <i class="fas fa-times text-xs"></i>
                </button>
            `;

        tabsContainer.appendChild(tab);
        saveState();
      }

      function updateActiveTab(path) {
        document.querySelectorAll("[data-file]").forEach((tab) => {
          tab.classList.remove("tab-active", "text-white");
          tab.classList.add("text-gray-400");
        });

        const activeTab = document.querySelector(
          `[data-file="${path.replace(/"/g, '\\"')}"]`
        );
        if (activeTab) {
          activeTab.classList.add("tab-active", "text-white");
          activeTab.classList.remove("text-gray-400");
        }
      }

      function closeTab(path) {
        const tab = document.querySelector(
          `[data-file="${path.replace(/"/g, '\\"')}"]`
        );
        if (tab) {
          tab.remove();
          openFiles.delete(path);

          // If closing current file, switch to another open file
          if (path === currentFile) {
            const remainingFiles = Array.from(openFiles);
            if (remainingFiles.length > 0) {
              openFile(remainingFiles[0]);
            } else {
              // No files open, clear editor
              if (editor) {
                editor.setValue("");
              }
              currentFile = null;
            }
          }
          saveState();
        }
      }

      function getFileIcon(filename) {
        const extension = filename.split(".").pop();
        const iconMap = {
          js: '<i class="fab fa-js-square text-yellow-400 text-xs"></i>',
          ts: '<i class="fab fa-js-square text-blue-400 text-xs"></i>',
          json: '<i class="fas fa-file-code text-green-400 text-xs"></i>',
          md: '<i class="fab fa-markdown text-blue-400 text-xs"></i>',
          env: '<i class="fas fa-cog text-gray-400 text-xs"></i>',
          yml: '<i class="fas fa-file-code text-red-400 text-xs"></i>',
          yaml: '<i class="fas fa-file-code text-red-400 text-xs"></i>',
          html: '<i class="fab fa-html5 text-orange-400 text-xs"></i>',
          css: '<i class="fab fa-css3-alt text-blue-400 text-xs"></i>',
          py: '<i class="fab fa-python text-blue-400 text-xs"></i>',
          c: '<i class="fas fa-file-code text-blue-400 text-xs"></i>',
          cpp: '<i class="fas fa-file-code text-blue-400 text-xs"></i>',
          java: '<i class="fab fa-java text-red-400 text-xs"></i>',
          go: '<i class="fas fa-file-code text-blue-400 text-xs"></i>',
          rs: '<i class="fas fa-file-code text-orange-400 text-xs"></i>',
          php: '<i class="fab fa-php text-purple-400 text-xs"></i>',
          rb: '<i class="fab fa-ruby text-red-400 text-xs"></i>',
          swift: '<i class="fab fa-swift text-orange-400 text-xs"></i>',
          kt: '<i class="fas fa-file-code text-purple-400 text-xs"></i>',
          scala: '<i class="fas fa-file-code text-red-400 text-xs"></i>',
        };
        return (
          iconMap[extension] ||
          '<i class="fas fa-file text-gray-400 text-xs"></i>'
        );
      }

      function markFileAsModified(path, modified) {
        const tab = document.querySelector(
          `[data-file="${path.replace(/"/g, '\\"')}"]`
        );
        if (tab) {
          let modifiedIndicator = tab.querySelector(".text-gray-500");
          if (modified && !modifiedIndicator) {
            const span = document.createElement("span");
            span.className = "text-xs text-gray-500";
            span.textContent = "";
            tab.insertBefore(span, tab.lastElementChild);
          } else if (!modified && modifiedIndicator) {
            modifiedIndicator.remove();
          }
        }
      }

      function refreshFiles() {
        updateFileTree();
        showNotification("Files refreshed", "info");
      }

      function collapseAll() {
        foldersOpen = new Set(["/"]);
        updateFileTree();
        showNotification("All folders collapsed", "info");
        saveState();
      }

      function saveFile() {
        if (editor && currentFile) {
          setContent(currentFile, editor.getValue());
          markFileAsModified(currentFile, false);
          showNotification(`Saved ${currentFile}`, "success");
          saveState();
        }
      }

      // Notification System
      function showNotification(message, type = "info") {
        const container = document.getElementById("notificationContainer");
        const notification = document.createElement("div");

        const colors = {
          success: "bg-green-600",
          error: "bg-red-600",
          warning: "bg-yellow-600",
          info: "bg-blue-600",
        };

        const icons = {
          success: "fas fa-check-circle",
          error: "fas fa-exclamation-circle",
          warning: "fas fa-exclamation-triangle",
          info: "fas fa-info-circle",
        };

        notification.className = `notification ${colors[type]} text-white px-4 py-2 rounded-lg shadow-lg flex items-center space-x-2`;
        notification.innerHTML = `
                <i class="${icons[type]}"></i>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            `;

        container.appendChild(notification);

        // Auto remove after 5 seconds
        setTimeout(() => {
          if (notification.parentElement) {
            notification.remove();
          }
        }, 5000);
      }

      // Timer functionality
      function updateTimer() {
        const elapsed = Date.now() - startTime;
        const minutes = Math.floor(elapsed / 60000);
        const seconds = Math.floor((elapsed % 60000) / 1000);
        document.getElementById("timer").textContent = `${minutes
          .toString()
          .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
      }

      // Status bar updates
      function updateStatusBar() {
        if (editor) {
          const position = editor.getPosition();
          document.getElementById(
            "cursorPosition"
          ).textContent = `Ln ${position.lineNumber}, Col ${position.column}`;

          const model = editor.getModel();
          const content = model.getValue();
          const size = new Blob([content]).size;
          document.getElementById("fileSize").textContent = formatBytes(size);
        }
      }

      function formatBytes(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + " " + sizes[i];
      }

      function populateLanguageSelect(current) {
        const select = document.getElementById("languageSelect");
        select.innerHTML = "";
        const languages = [
          "javascript",
          "typescript",
          "json",
          "markdown",
          "shell",
          "yaml",
          "html",
          "css",
          "python",
          "c",
          "cpp",
          "java",
          "go",
          "rust",
          "php",
          "ruby",
          "swift",
          "kotlin",
          "scala",
          "plaintext",
          "typescript",
          "typescriptjsx"
        ];
        languages.forEach((lang) => {
          const opt = document.createElement("option");
          opt.value = lang;
          opt.textContent = lang.charAt(0).toUpperCase() + lang.slice(1);
          if (lang === current) opt.selected = true;
          select.appendChild(opt);
        });
      }

      function changeLanguage() {
        const lang = document.getElementById("languageSelect").value;
        monaco.editor.setModelLanguage(editor.getModel(), lang);
      }

      // Panel switching
      function switchRightPanel(panel) {
        // Update tabs
        document
          .querySelectorAll("#outputTab, #apiTab, #testsTab")
          .forEach((tab) => {
            tab.classList.remove("tab-active", "text-white");
            tab.classList.add("text-gray-400");
          });
        document
          .getElementById(panel + "Tab")
          .classList.add("tab-active", "text-white");

        // Update panels
        document
          .querySelectorAll("#outputPanel, #apiPanel, #testsPanel")
          .forEach((p) => {
            p.classList.add("hidden");
            p.classList.remove("flex");
          });
        document.getElementById(panel + "Panel").classList.remove("hidden");
        document.getElementById(panel + "Panel").classList.add("flex");
      }

      // Terminal functionality
      function updateTerminalPrompt() {
        document.getElementById("terminalPrompt").textContent =
          currentWorkingDirectory;
      }

      function handleTerminalInput(event) {
        if (event.key === "Enter") {
          event.preventDefault();
          const command = event.target.value.trim();
          if (command) {
            executeCommand(command);
            terminalHistory.push(command);
            terminalHistoryIndex = terminalHistory.length;
          }
          event.target.value = "";
        } else if (event.key === "ArrowUp") {
          if (terminalHistoryIndex > 0) {
            terminalHistoryIndex--;
            event.target.value = terminalHistory[terminalHistoryIndex];
          }
        } else if (event.key === "ArrowDown") {
          if (terminalHistoryIndex < terminalHistory.length - 1) {
            terminalHistoryIndex++;
            event.target.value = terminalHistory[terminalHistoryIndex];
          } else {
            terminalHistoryIndex = terminalHistory.length;
            event.target.value = "";
          }
        }
      }

      function executeCommand(command) {
        const terminal = document.getElementById("terminalOutput");
        const args = command.split(" ").filter((a) => a);
        const cmd = args[0].toLowerCase();

        // Add command to terminal
        terminal.innerHTML += `<div class="text-green-400">BackendMentor@Gamer:${currentWorkingDirectory}$ ${command}</div>`;

        switch (cmd) {
          case "help":
            terminal.innerHTML += `<div class="text-gray-300">Available commands:
  ls [options] - List directory contents (options: -l, -a)<br/>
  cd [dir]     - Change directory <br/>
  pwd          - Print working directory <br/>
  cat [file]   - Display file contents <br/>
  vi / nano [file] - Open file in editor <br/>
  echo [text]  - Echo text <br/>
  whoami       - Current user <br/>
  npm [cmd]    - Node package manager (simulated: install, start, test) <br/>
  node [file]  - Run JavaScript files <br/>
  clear        - Clear terminal <br/>
  mkdir [dir]  - Create directory <br/>
  touch [file] - Create file <br/>
  rm [path]    - Remove files or empty directories <br/>
  cp [src] [dest] - Copy file or directory <br/>
  mv [src] [dest] - Move/rename file or directory <br/>
  find [dir] -name [pattern] - Find files <br/>
  grep [pattern] [file] - Search in file <br/>
  wc [file]    - Word count <br/>
  head [file]  - Show first lines <br/>
  tail [file]  - Show last lines <br/>
  dir          - Alias for ls <br/>
  date         - Show current date <br/>
  uname        - System info <br/>
  hostname     - Host name <br/>
  env          - Environment variables <br/>
  export [var]=[value] - Set environment variable <br/>
  unset [var]  - Unset environment variable <br/>
  history      - Show command history <br/>
  ! [num]      - Execute history command <br/>
  alias [name]=[cmd] - Set alias <br/>
  unalias [name] - Remove alias <br/>
  type [cmd]   - Command type <br/>
  which [cmd]  - Command location (simulated) <br/>
  man [cmd]    - Manual (simulated) <br/>
  info [cmd]   - Info (simulated) <br/>
  apropos [keyword] - Search manuals
  ps           - Processes (simulated)
  top          - Task manager (simulated)
  kill [pid]   - Kill process (simulated)
  df           - Disk free (simulated)
  du [dir]     - Disk usage (simulated)
  free         - Memory free (simulated)
  tar [options] [file] - Archive (simulated)
  zip [file]   - Zip (simulated)
  unzip [file] - Unzip (simulated)
  wget [url]   - Download (simulated)
  curl [url]   - Curl (simulated)
  ping [host]  - Ping (simulated)
  traceroute [host] - Traceroute (simulated)
  netstat      - Netstat (simulated)
  ifconfig     - Ifconfig (simulated)
  ip [cmd]     - IP commands (simulated)
  ssh [host]   - SSH (simulated)
  scp [src] [dest] - SCP (simulated)
  rsync [src] [dest] - Rsync (simulated)
  git [cmd]    - Git commands (simulated: status, add, commit, push, pull, clone, branch, checkout, merge)
  test         - Run tests
  rahim [question] - Ask Rahim AI for help
And many more Linux-like commands... Type 'help2' for more.</div>`;
            break;

          case "help2":
            terminal.innerHTML += `<div class="text-gray-300">More commands:
  awk [script] [file] - Awk (simulated)
  sed [script] [file] - Sed (simulated)
  cut [options] [file] - Cut (simulated)
  paste [files] - Paste (simulated)
  sort [file]  - Sort (simulated)
  uniq [file]  - Uniq (simulated)
  tee [file]   - Tee (simulated)
  diff [file1] [file2] - Diff (simulated)
  patch [file] - Patch (simulated)
  make [target] - Make (simulated)
  cmake [dir]  - CMake (simulated)
  gcc [file]   - GCC (simulated)
  g++ [file]   - G++ (simulated)
  javac [file] - Javac (simulated)
  java [class] - Java (simulated)
  python [file] - Python (simulated)
  pip [cmd]    - Pip (simulated)
  apt [cmd]    - Apt (simulated)
  yum [cmd]    - Yum (simulated)
  dnf [cmd]    - Dnf (simulated)
  brew [cmd]   - Brew (simulated)
  systemctl [cmd] - Systemctl (simulated)
  service [cmd] - Service (simulated)
  journalctl   - Journalctl (simulated)
  useradd [user] - Add user (simulated)
  usermod [options] [user] - Modify user (simulated)
  userdel [user] - Delete user (simulated)
  groupadd [group] - Add group (simulated)
  passwd [user] - Change password (simulated)
  su [user]    - Switch user (simulated)
  sudo [cmd]   - Sudo (simulated)
  chmod [mode] [file] - Change mode (simulated)
  chown [owner] [file] - Change owner (simulated)
  chgrp [group] [file] - Change group (simulated)
  ln [target] [link] - Link (simulated)
  readlink [link] - Read link (simulated)
  stat [file]  - Stat (simulated)
  touch [options] [file] - Touch advanced
  mkdir [options] [dir] - Mkdir advanced
  rmdir [dir]  - Remove empty directory
  rm [options] [path] - Rm advanced (-r, -f)
  cp [options] [src] [dest] - Cp advanced (-r)
  mv [options] [src] [dest] - Mv advanced
</div>`;
            break;

          case "ls":
            let detailed = false;
            let showHidden = false;
            let dir = currentWorkingDirectory;
            for (let arg of args.slice(1)) {
              if (arg === "-l") detailed = true;
              else if (arg === "-a") showHidden = true;
              else if (arg.startsWith("-")) {
                terminal.innerHTML += `<div class="text-red-400">ls: invalid option -- '${arg}'</div>`;
                return;
              } else {
                dir = resolvePath(currentWorkingDirectory, arg);
              }
            }
            const children = getChildren(dir);
            let output = "";
            if (detailed) {
              children.forEach((c) => {
                if (!showHidden && c.name.startsWith(".")) return;
                output += `drwxr-xr-x 1 user user 4096 Aug 29 12:00 ${c.name}${
                  c.type === "folder" ? "/" : ""
                }<br>`;
              });
              terminal.innerHTML += `<div class="text-blue-400">${output.replace(
                /\n/g,
                "<br>"
              )}</div>`;
            } else {
              output = children
                .filter((c) => showHidden || !c.name.startsWith("."))
                .map((c) => c.name + (c.type === "folder" ? "/" : ""))
                .join("  ");
              terminal.innerHTML += `<div class="text-blue-400">${
                output || "(empty)"
              }</div>`;
            }
            break;

          case "cd":
            const rel = args[1] || "/";
            const newPath = resolvePath(currentWorkingDirectory, rel);
            const node = getNode(newPath);
            if (node && node.type === "folder") {
              currentWorkingDirectory = newPath.endsWith("/")
                ? newPath
                : newPath + "/";
              updateTerminalPrompt();
              saveState();
            } else {
              terminal.innerHTML += `<div class="text-red-400">cd: ${rel}: No such directory</div>`;
            }
            break;

          case "pwd":
            terminal.innerHTML += `<div class="text-blue-400">${currentWorkingDirectory}</div>`;
            break;

          case "cat":
            if (args[1]) {
              const filePath = resolvePath(currentWorkingDirectory, args[1]);
              const content = getContent(filePath);
              if (content !== null) {
                terminal.innerHTML += `<div class="text-gray-300">${content.replace(
                  /\n/g,
                  "<br>"
                )}</div>`;
              } else {
                terminal.innerHTML += `<div class="text-red-400">cat: ${args[1]}: No such file or directory</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">cat: missing file operand</div>`;
            }
            break;

          case "vi":
          case "nano":
            if (args[1]) {
              const filePath = resolvePath(currentWorkingDirectory, args[1]);
              if (getContent(filePath) !== null) {
                openFile(filePath);
                terminal.innerHTML += `<div class="text-green-400">Opening ${filePath} in editor</div>`;
              } else {
                terminal.innerHTML += `<div class="text-red-400">${cmd}: ${args[1]}: No such file</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">${cmd}: missing file operand</div>`;
            }
            break;

          case "echo":
            terminal.innerHTML += `<div class="text-gray-300">${args
              .slice(1)
              .join(" ")}</div>`;
            break;

          case "whoami":
            terminal.innerHTML += `<div class="text-blue-400">gamer</div>`;
            break;

          case "npm":
            if (args[1] === "install" || args[1] === "i") {
              terminal.innerHTML += `<div class="text-gray-300">Installing dependencies...</div>`;
              setTimeout(() => {
                terminal.innerHTML += `<div class="text-green-400"> Dependencies installed successfully</div>`;
                terminal.scrollTop = terminal.scrollHeight;
              }, 2000);
            } else if (args[1] === "start") {
              terminal.innerHTML += `<div class="text-blue-400">[INFO] Starting server...</div>`;
              setTimeout(() => {
                terminal.innerHTML += `<div class="text-green-400">[SUCCESS] Server running on port 3000</div>`;
                terminal.scrollTop = terminal.scrollHeight;
              }, 1000);
            } else if (args[1] === "test") {
              runTests();
            } else {
              terminal.innerHTML += `<div class="text-gray-300">npm ${args
                .slice(1)
                .join(" ")}</div>`;
            }
            break;

          case "node":
            if (args[1]) {
              const filePath = resolvePath(currentWorkingDirectory, args[1]);
              const code = getContent(filePath);
              if (code) {
                terminal.innerHTML += `<div class="text-blue-400">Running ${args[1]}...</div>`;
                try {
                  const oldConsoleLog = console.log;
                  console.log = (msg) => {
                    terminal.innerHTML += `<div class="text-gray-300">${msg}</div>`;
                    terminal.scrollTop = terminal.scrollHeight;
                  };
                  new Function(code)();
                  console.log = oldConsoleLog;
                } catch (e) {
                  terminal.innerHTML += `<div class="text-red-400">Error: ${e.message}</div>`;
                }
              } else {
                terminal.innerHTML += `<div class="text-red-400">node: ${args[1]}: No such file</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">Usage: node <filename></div>`;
            }
            break;

          case "clear":
            clearTerminal();
            return;

          case "rahim":
            const question = args.slice(1).join(" ") || "help";
            terminal.innerHTML += `<div class="text-purple-400">[RAHIM] Processing your request...</div>`;
            askAI(question);
            break;

          case "git":
            if (args[1] === "status") {
              terminal.innerHTML += `<div class="text-gray-300">On branch main
Your branch is up to date with 'origin/main'.

Changes not staged for commit:
  modified:   ${currentFile || "server.js"}

no changes added to commit</div>`;
            } else if (args[1] === "add") {
              terminal.innerHTML += `<div class="text-green-400">Files staged for commit</div>`;
            } else if (args[1] === "commit") {
              terminal.innerHTML += `<div class="text-green-400">[main abc123] ${args
                .slice(3)
                .join(" ")}</div>`;
            } else if (args[1] === "push") {
              terminal.innerHTML += `<div class="text-green-400">Pushed to remote (simulated)</div>`;
            } else if (args[1] === "pull") {
              terminal.innerHTML += `<div class="text-green-400">Pulled from remote (simulated)</div>`;
            } else if (args[1] === "clone") {
              terminal.innerHTML += `<div class="text-green-400">Cloned repository (simulated)</div>`;
            } else if (args[1] === "branch") {
              terminal.innerHTML += `<div class="text-blue-400">* main</div>`;
            } else if (args[1] === "checkout") {
              terminal.innerHTML += `<div class="text-green-400">Switched branch (simulated)</div>`;
            } else if (args[1] === "merge") {
              terminal.innerHTML += `<div class="text-green-400">Merged (simulated)</div>`;
            } else {
              terminal.innerHTML += `<div class="text-gray-300">git ${args
                .slice(1)
                .join(" ")}</div>`;
            }
            break;

          case "mkdir":
            if (args[1]) {
              const folderPath = resolvePath(currentWorkingDirectory, args[1]);
              if (addFolder(folderPath)) {
                updateFileTree();
                terminal.innerHTML += `<div class="text-green-400">Directory '${args[1]}' created</div>`;
                saveState();
              } else {
                terminal.innerHTML += `<div class="text-red-400">mkdir: cannot create directory '${args[1]}': File exists</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">mkdir: missing operand</div>`;
            }
            break;

          case "touch":
            if (args[1]) {
              const filePath = resolvePath(currentWorkingDirectory, args[1]);
              if (addFile(filePath)) {
                updateFileTree();
                terminal.innerHTML += `<div class="text-green-400">File '${args[1]}' created</div>`;
                saveState();
              } else {
                terminal.innerHTML += `<div class="text-red-400">touch: cannot touch '${args[1]}': File exists or invalid path</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">touch: missing file operand</div>`;
            }
            break;

          case "rm":
            if (args[1]) {
              const rmPath = resolvePath(currentWorkingDirectory, args[1]);
              if (removePath(rmPath)) {
                if (openFiles.has(rmPath)) {
                  closeTab(rmPath);
                }
                updateFileTree();
                terminal.innerHTML += `<div class="text-green-400">Removed '${args[1]}'</div>`;
                saveState();
              } else {
                terminal.innerHTML += `<div class="text-red-400">rm: cannot remove '${args[1]}': No such file or directory or directory not empty</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">rm: missing operand</div>`;
            }
            break;

          case "cp":
            if (args.length >= 3) {
              const src = resolvePath(currentWorkingDirectory, args[1]);
              const dest = resolvePath(currentWorkingDirectory, args[2]);
              if (copyPath(src, dest)) {
                updateFileTree();
                terminal.innerHTML += `<div class="text-green-400">Copied '${args[1]}' to '${args[2]}'</div>`;
                saveState();
              } else {
                terminal.innerHTML += `<div class="text-red-400">cp: failed to copy '${args[1]}' to '${args[2]}'</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">cp: missing operands</div>`;
            }
            break;

          case "mv":
            if (args.length >= 3) {
              const src = resolvePath(currentWorkingDirectory, args[1]);
              const dest = resolvePath(currentWorkingDirectory, args[2]);
              if (movePath(src, dest)) {
                if (openFiles.has(src)) {
                  closeTab(src);
                  openFile(dest);
                }
                updateFileTree();
                terminal.innerHTML += `<div class="text-green-400">Moved '${args[1]}' to '${args[2]}'</div>`;
                saveState();
              } else {
                terminal.innerHTML += `<div class="text-red-400">mv: failed to move '${args[1]}' to '${args[2]}'</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">mv: missing operands</div>`;
            }
            break;

          case "find":
            // Simple implementation
            if (args[1] === "." && args[2] === "-name") {
              const pattern = args[3].replace(/\*/g, ".*");
              const regex = new RegExp(pattern);
              const results = findFiles(fileSystem, "/", regex);
              terminal.innerHTML += `<div class="text-blue-400">${results.join(
                "<br>"
              )}</div>`;
            } else {
              terminal.innerHTML += `<div class="text-red-400">find: invalid arguments</div>`;
            }
            break;

          case "grep":
            if (args.length >= 3) {
              const pattern = args[1];
              const filePath = resolvePath(currentWorkingDirectory, args[2]);
              const content = getContent(filePath);
              if (content) {
                const lines = content.split("\n");
                const matches = lines.filter((line) => line.includes(pattern));
                terminal.innerHTML += `<div class="text-gray-300">${matches.join(
                  "<br>"
                )}</div>`;
              } else {
                terminal.innerHTML += `<div class="text-red-400">grep: ${args[2]}: No such file</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">grep: missing operands</div>`;
            }
            break;

          case "wc":
            if (args[1]) {
              const filePath = resolvePath(currentWorkingDirectory, args[1]);
              const content = getContent(filePath);
              if (content) {
                const lines = content.split("\n").length;
                const words = content.split(/\s+/).length;
                const chars = content.length;
                terminal.innerHTML += `<div class="text-blue-400">${lines} ${words} ${chars} ${args[1]}</div>`;
              } else {
                terminal.innerHTML += `<div class="text-red-400">wc: ${args[1]}: No such file</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">wc: missing operand</div>`;
            }
            break;

          case "head":
            if (args[1]) {
              const filePath = resolvePath(currentWorkingDirectory, args[1]);
              const content = getContent(filePath);
              if (content) {
                const lines = content.split("\n").slice(0, 10).join("<br>");
                terminal.innerHTML += `<div class="text-gray-300">${lines}</div>`;
              } else {
                terminal.innerHTML += `<div class="text-red-400">head: ${args[1]}: No such file</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">head: missing operand</div>`;
            }
            break;

          case "tail":
            if (args[1]) {
              const filePath = resolvePath(currentWorkingDirectory, args[1]);
              const content = getContent(filePath);
              if (content) {
                const lines = content.split("\n").slice(-10).join("<br>");
                terminal.innerHTML += `<div class="text-gray-300">${lines}</div>`;
              } else {
                terminal.innerHTML += `<div class="text-red-400">tail: ${args[1]}: No such file</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">tail: missing operand</div>`;
            }
            break;

          case "dir":
            executeCommand("ls " + args.slice(1).join(" "));
            break;

          case "date":
            terminal.innerHTML += `<div class="text-blue-400">${new Date().toString()}</div>`;
            break;

          case "uname":
            terminal.innerHTML += `<div class="text-blue-400">Linux</div>`;
            break;

          case "hostname":
            terminal.innerHTML += `<div class="text-blue-400">backend-mentor</div>`;
            break;

          case "env":
            terminal.innerHTML += `<div class="text-gray-300">PATH=/usr/bin:/bin
HOME=/home/user
PWD=${currentWorkingDirectory}</div>`;
            break;

          case "export":
            terminal.innerHTML += `<div class="text-green-400">Variable set (simulated)</div>`;
            break;

          case "unset":
            terminal.innerHTML += `<div class="text-green-400">Variable unset (simulated)</div>`;
            break;

          case "history":
            terminal.innerHTML += `<div class="text-gray-300">${terminalHistory
              .map((h, i) => i + 1 + "  " + h)
              .join("<br>")}</div>`;
            break;

          case "!":
            const num = parseInt(args[1]);
            if (num > 0 && num <= terminalHistory.length) {
              const cmd = terminalHistory[num - 1];
              terminal.innerHTML += `<div class="text-green-400">Executing: ${cmd}</div>`;
              executeCommand(cmd);
            } else {
              terminal.innerHTML += `<div class="text-red-400">!: invalid history number</div>`;
            }
            break;

          case "alias":
            terminal.innerHTML += `<div class="text-green-400">Alias set (simulated)</div>`;
            break;

          case "unalias":
            terminal.innerHTML += `<div class="text-green-400">Alias removed (simulated)</div>`;
            break;

          case "type":
            terminal.innerHTML += `<div class="text-blue-400">${args[1]} is a shell builtin</div>`;
            break;

          case "which":
            terminal.innerHTML += `<div class="text-blue-400">/usr/bin/${args[1]}</div>`;
            break;

          case "man":
            terminal.innerHTML += `<div class="text-gray-300">Manual for ${args[1]} (simulated content)</div>`;
            break;

          case "info":
            terminal.innerHTML += `<div class="text-gray-300">Info for ${args[1]} (simulated content)</div>`;
            break;

          case "apropos":
            terminal.innerHTML += `<div class="text-gray-300">Commands related to ${args[1]}: ls, cd, etc.</div>`;
            break;

          case "ps":
            terminal.innerHTML += `<div class="text-gray-300">PID TTY          TIME CMD
  1 ?        00:00:01 init
  2 ?        00:00:00 terminal</div>`;
            break;

          case "top":
            terminal.innerHTML += `<div class="text-gray-300">top - simulated task manager</div>`;
            break;

          case "kill":
            terminal.innerHTML += `<div class="text-green-400">Process killed (simulated)</div>`;
            break;

          case "df":
            terminal.innerHTML += `<div class="text-gray-300">Filesystem     1K-blocks    Used Available Use% Mounted on
tmpfs             1000000   10000   990000   1% /</div>`;
            break;

          case "du":
            terminal.innerHTML += `<div class="text-gray-300">4K .</div>`;
            break;

          case "free":
            terminal.innerHTML += `<div class="text-gray-300">              total        used        free      shared  buff/cache   available
Mem:            8192         100        8000           0          92        8092</div>`;
            break;

          case "tar":
            terminal.innerHTML += `<div class="text-green-400">Archive created/extracted (simulated)</div>`;
            break;

          case "zip":
            terminal.innerHTML += `<div class="text-green-400">Zipped (simulated)</div>`;
            break;

          case "unzip":
            terminal.innerHTML += `<div class="text-green-400">Unzipped (simulated)</div>`;
            break;

          case "wget":
            terminal.innerHTML += `<div class="text-green-400">Downloaded (simulated)</div>`;
            break;

          case "curl":
            terminal.innerHTML += `<div class="text-gray-300">curl output (simulated)</div>`;
            break;

          case "ping":
            terminal.innerHTML += `<div class="text-gray-300">PING ${args[1]} (127.0.0.1): 56 data bytes
64 bytes from 127.0.0.1: icmp_seq=0 ttl=64 time=0 ms</div>`;
            break;

          case "traceroute":
            terminal.innerHTML += `<div class="text-gray-300">traceroute to ${args[1]} (127.0.0.1), 30 hops max
 1  127.0.0.1 (127.0.0.1)  0 ms  0 ms  0 ms</div>`;
            break;

          case "netstat":
            terminal.innerHTML += `<div class="text-gray-300">Active connections (simulated)</div>`;
            break;

          case "ifconfig":
            terminal.innerHTML += `<div class="text-gray-300">eth0: inet 127.0.0.1</div>`;
            break;

          case "ip":
            terminal.innerHTML += `<div class="text-gray-300">1: lo: <LOOPBACK,UP> mtu 65536
    inet 127.0.0.1/8 scope host lo</div>`;
            break;

          case "ssh":
            terminal.innerHTML += `<div class="text-green-400">Connected to ${args[1]} (simulated)</div>`;
            break;

          case "scp":
            terminal.innerHTML += `<div class="text-green-400">Copied via scp (simulated)</div>`;
            break;

          case "rsync":
            terminal.innerHTML += `<div class="text-green-400">Synced (simulated)</div>`;
            break;

          case "awk":
            terminal.innerHTML += `<div class="text-gray-300">awk output (simulated)</div>`;
            break;

          case "sed":
            terminal.innerHTML += `<div class="text-gray-300">sed output (simulated)</div>`;
            break;

          case "cut":
            terminal.innerHTML += `<div class="text-gray-300">cut output (simulated)</div>`;
            break;

          case "paste":
            terminal.innerHTML += `<div class="text-gray-300">paste output (simulated)</div>`;
            break;

          case "sort":
            if (args[1]) {
              const filePath = resolvePath(currentWorkingDirectory, args[1]);
              const content = getContent(filePath);
              if (content) {
                const sorted = content.split("\n").sort().join("\n");
                terminal.innerHTML += `<div class="text-gray-300">${sorted.replace(/\n/g, "<br>")}</div>`;
              } else {
                terminal.innerHTML += `<div class="text-red-400">sort: ${args[1]}: No such file</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">sort: missing operand</div>`;
            }
            break;

          case "uniq":
            terminal.innerHTML += `<div class="text-gray-300">uniq output (simulated)</div>`;
            break;

          case "tee":
            terminal.innerHTML += `<div class="text-gray-300">tee output (simulated)</div>`;
            break;

          case "diff":
            terminal.innerHTML += `<div class="text-gray-300">diff output (simulated)</div>`;
            break;

          case "patch":
            terminal.innerHTML += `<div class="text-green-400">patched (simulated)</div>`;
            break;

          case "make":
            terminal.innerHTML += `<div class="text-green-400">make done (simulated)</div>`;
            break;

          case "cmake":
            terminal.innerHTML += `<div class="text-green-400">cmake done (simulated)</div>`;
            break;

          case "gcc":
            terminal.innerHTML += `<div class="text-green-400">compiled (simulated)</div>`;
            break;

          case "g++":
            terminal.innerHTML += `<div class="text-green-400">compiled (simulated)</div>`;
            break;

          case "javac":
            terminal.innerHTML += `<div class="text-green-400">compiled (simulated)</div>`;
            break;

          case "java":
            terminal.innerHTML += `<div class="text-blue-400">running java (simulated)</div>`;
            break;

          case "python":
            if (args[1]) {
              const filePath = resolvePath(currentWorkingDirectory, args[1]);
              const code = getContent(filePath);
              if (code) {
                terminal.innerHTML += `<div class="text-blue-400">Running Python code (simulated output)</div>`;
                terminal.innerHTML += `<div class="text-gray-300">Python output: Hello from Python!</div>`; // Simulate, since no Python runner
              } else {
                terminal.innerHTML += `<div class="text-red-400">python: ${args[1]}: No such file</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">Usage: python <filename></div>`;
            }
            break;

          case "pip":
            terminal.innerHTML += `<div class="text-green-400">pip action (simulated)</div>`;
            break;

          case "apt":
            terminal.innerHTML += `<div class="text-green-400">apt action (simulated)</div>`;
            break;

          case "yum":
            terminal.innerHTML += `<div class="text-green-400">yum action (simulated)</div>`;
            break;

          case "dnf":
            terminal.innerHTML += `<div class="text-green-400">dnf action (simulated)</div>`;
            break;

          case "brew":
            terminal.innerHTML += `<div class="text-green-400">brew action (simulated)</div>`;
            break;

          case "systemctl":
            terminal.innerHTML += `<div class="text-green-400">systemctl action (simulated)</div>`;
            break;

          case "service":
            terminal.innerHTML += `<div class="text-green-400">service action (simulated)</div>`;
            break;

          case "journalctl":
            terminal.innerHTML += `<div class="text-gray-300">logs (simulated)</div>`;
            break;

          case "useradd":
            terminal.innerHTML += `<div class="text-green-400">user added (simulated)</div>`;
            break;

          case "usermod":
            terminal.innerHTML += `<div class="text-green-400">user modified (simulated)</div>`;
            break;

          case "userdel":
            terminal.innerHTML += `<div class="text-green-400">user deleted (simulated)</div>`;
            break;

          case "groupadd":
            terminal.innerHTML += `<div class="text-green-400">group added (simulated)</div>`;
            break;

          case "passwd":
            terminal.innerHTML += `<div class="text-green-400">password changed (simulated)</div>`;
            break;

          case "su":
            terminal.innerHTML += `<div class="text-green-400">switched user (simulated)</div>`;
            break;

          case "sudo":
            executeCommand(args.slice(1).join(" "));
            break;

          case "chmod":
            terminal.innerHTML += `<div class="text-green-400">permissions changed (simulated)</div>`;
            break;

          case "chown":
            terminal.innerHTML += `<div class="text-green-400">owner changed (simulated)</div>`;
            break;

          case "chgrp":
            terminal.innerHTML += `<div class="text-green-400">group changed (simulated)</div>`;
            break;

          case "ln":
            terminal.innerHTML += `<div class="text-green-400">link created (simulated)</div>`;
            break;

          case "readlink":
            terminal.innerHTML += `<div class="text-blue-400">link target (simulated)</div>`;
            break;

          case "stat":
            terminal.innerHTML += `<div class="text-gray-300">stat info (simulated)</div>`;
            break;

          case "rmdir":
            if (args[1]) {
              const dirPath = resolvePath(currentWorkingDirectory, args[1]);
              if (removePath(dirPath)) {
                updateFileTree();
                terminal.innerHTML += `<div class="text-green-400">Removed directory '${args[1]}'</div>`;
                saveState();
              } else {
                terminal.innerHTML += `<div class="text-red-400">rmdir: failed to remove '${args[1]}': Directory not empty or not found</div>`;
              }
            } else {
              terminal.innerHTML += `<div class="text-red-400">rmdir: missing operand</div>`;
            }
            break;

          case "test":
            runTests();
            break;

          default:
            terminal.innerHTML += `<div class="text-red-400">Command not found: ${cmd}. Type 'help' for available commands.</div>`;
            break;
        }

        terminal.scrollTop = terminal.scrollHeight;
      }

      function clearTerminal() {
        document.getElementById("terminalOutput").innerHTML = `
                <div class="text-green-400">Welcome to Backend Mentor Terminal</div>
                <div class="text-gray-300">Type 'help' for available commands</div>
                <div class="text-purple-400">[AI] Rahim is ready to assist you!</div>
            `;
      }

      function findFiles(node, path, regex) {
        let results = [];
        Object.keys(node.children).forEach((name) => {
          const fullPath =
            path + name + (node.children[name].type === "folder" ? "/" : "");
          if (node.children[name].type === "folder") {
            results = results.concat(
              findFiles(node.children[name], fullPath, regex)
            );
          } else if (regex.test(name)) {
            results.push(fullPath);
          }
        });
        return results;
      }

      function splitTerminal() {
        showNotification("Terminal split not implemented", "warning");
      }

      function newTerminal() {
        showNotification("New terminal not implemented", "warning");
      }

      // Code execution
      function runCode() {
        if (!currentFile) {
          showNotification("No file selected to run", "warning");
          return;
        }
        showNotification("Running code...", "info");
        switchRightPanel("output");

        const terminal = document.getElementById("terminalOutput");
        terminal.innerHTML += `
                <div class="text-green-400 mt-2">${currentWorkingDirectory}$ node ${currentFile}</div>
                <div class="text-blue-400">[INFO] Executing code...</div>
            `;

        const code = getContent(currentFile);
        try {
          const oldConsoleLog = console.log;
          console.log = (msg) => {
            terminal.innerHTML += `<div class="text-gray-300">${msg}</div>`;
            terminal.scrollTop = terminal.scrollHeight;
          };
          new Function(code)();
          console.log = oldConsoleLog;
          terminal.innerHTML += `<div class="text-green-400">[SUCCESS] Code executed</div>`;
        } catch (e) {
          terminal.innerHTML += `<div class="text-red-400">[ERROR] ${e.message}</div>`;
        }
        terminal.scrollTop = terminal.scrollHeight;

        showNotification("Code execution completed!", "success");
      }

      function submitCode() {
        showNotification("Submitting solution...", "info");

        setTimeout(() => {
          showNotification("Solution submitted! Running tests...", "success");
          runTests();

          setTimeout(() => {
            updateProgress(4, 5);
            showNotification("Great progress! 4/5 tests passing", "success");
          }, 3000);
        }, 2000);
      }

      function updateProgress(passed, total) {
        const percentage = (passed / total) * 100;
        document.getElementById("progressBar").style.width = percentage + "%";
        document.getElementById(
          "progressText"
        ).textContent = `${passed}/${total} tests`;
      }

      // Test execution
      function runTests() {
        showNotification("Running tests...", "info");
        switchRightPanel("tests");

        const testResults = document.getElementById("testResults");
        testResults.innerHTML =
          '<div class="text-yellow-400">Running tests...</div>';

        setTimeout(() => {
          testResults.innerHTML = `
                    <div class="flex items-center space-x-3 p-2 bg-green-500/10 border border-green-500/20 rounded">
                        <i class="fas fa-check-circle test-passed"></i>
                        <div class="flex-1">
                            <div class="text-sm text-white">Server starts successfully</div>
                            <div class="text-xs text-gray-400"> Express server listening on port 3000</div>
                        </div>
                        <div class="text-xs text-gray-400">12ms</div>
                    </div>
                    
                    <div class="flex items-center space-x-3 p-2 bg-green-500/10 border border-green-500/20 rounded">
                        <i class="fas fa-check-circle test-passed"></i>
                        <div class="flex-1">
                            <div class="text-sm text-white">JWT token generation</div>
                            <div class="text-xs text-gray-400"> Valid JWT token created on login</div>
                        </div>
                        <div class="text-xs text-gray-400">8ms</div>
                    </div>
                    
                    <div class="flex items-center space-x-3 p-2 bg-green-500/10 border border-green-500/20 rounded">
                        <i class="fas fa-check-circle test-passed"></i>
                        <div class="flex-1">
                            <div class="text-sm text-white">Login endpoint works</div>
                            <div class="text-xs text-gray-400"> POST /api/auth/login returns 200</div>
                        </div>
                        <div class="text-xs text-gray-400">45ms</div>
                    </div>
                    
                    <div class="flex items-center space-x-3 p-2 bg-green-500/10 border border-green-500/20 rounded">
                        <i class="fas fa-check-circle test-passed"></i>
                        <div class="flex-1">
                            <div class="text-sm text-white">Protected route middleware</div>
                            <div class="text-xs text-gray-400"> Middleware function implemented correctly</div>
                        </div>
                        <div class="text-xs text-gray-400">23ms</div>
                    </div>
                    
                    <div class="flex items-center space-x-3 p-2 bg-yellow-500/10 border border-yellow-500/20 rounded">
                        <i class="fas fa-clock test-pending"></i>
                        <div class="flex-1">
                            <div class="text-sm text-white">Error handling</div>
                            <div class="text-xs text-gray-400"> Some error cases not handled</div>
                        </div>
                        <div class="text-xs text-gray-400">-</div>
                    </div>
                `;

          showNotification("Tests completed! 4/5 passed", "success");
          updateProgress(4, 5);
        }, 2000);
      }

      function debugTests() {
        showNotification("Starting test debugger...", "info");
      }

      function watchTests() {
        showNotification("Test watcher started", "info");
      }

      // API Testing
      function sendAPIRequest() {
        const method = document.getElementById("httpMethod").value;
        const url = document.getElementById("apiUrl").value;
        const body = document.getElementById("requestBody").value;

        showNotification("Sending API request...", "info");

        const headers = {};
        document.querySelectorAll("#headersContainer div").forEach((div) => {
          const inputs = div.querySelectorAll("input");
          if (inputs[0].value && inputs[1].value) {
            headers[inputs[0].value] = inputs[1].value;
          }
        });

        let parsedBody;
        try {
          parsedBody = JSON.parse(body);
        } catch {
          parsedBody = body;
        }

        const startTime = Date.now();
        fetch(url, {
          method,
          headers,
          body: method !== "GET" ? JSON.stringify(parsedBody) : undefined,
        })
          .then((res) => {
            const status = res.status;
            const statusText = res.statusText;
            return res.json().then((data) => ({ status, statusText, data }));
          })
          .then((response) => {
            const responseTime = Date.now() - startTime;
            const responseSize = JSON.stringify(response.data).length;
            document.getElementById(
              "responseStatus"
            ).textContent = `${response.status} ${response.statusText}`;
            document.getElementById(
              "responseTime"
            ).textContent = `${responseTime}ms`;
            document.getElementById("responseSize").textContent =
              formatBytes(responseSize);
            document.getElementById("responseBody").innerHTML = JSON.stringify(
              response.data,
              null,
              2
            )
              .replace(/\n/g, "<br>")
              .replace(/ /g, "&nbsp;");
            showNotification("API request completed", "success");
          })
          .catch((error) => {
            document.getElementById("responseStatus").textContent = "Error";
            document.getElementById("responseBody").innerHTML = error.message;
            showNotification("API request failed: " + error.message, "error");
          });
      }

      function addHeader() {
        const container = document.getElementById("headersContainer");
        const headerDiv = document.createElement("div");
        headerDiv.className = "flex space-x-2";
        headerDiv.innerHTML = `
                <input type="text" class="flex-1 bg-gray-700 text-white text-xs rounded px-2 py-1 border border-gray-600" placeholder="Header Name">
                <input type="text" class="flex-1 bg-gray-700 text-white text-xs rounded px-2 py-1 border border-gray-600" placeholder="Header Value">
                <button onclick="removeHeader(this)" class="text-red-400 hover:text-red-300 text-xs">
                    <i class="fas fa-trash"></i>
                </button>
            `;
        container.appendChild(headerDiv);
      }

      function removeHeader(button) {
        button.parentElement.remove();
      }

      function changeBodyType() {
        const bodyType = document.getElementById("bodyType").value;
        const bodyTextarea = document.getElementById("requestBody");

        switch (bodyType) {
          case "json":
            bodyTextarea.placeholder = '{"key": "value"}';
            break;
          case "form":
            bodyTextarea.placeholder = "key1=value1&key2=value2";
            break;
          case "raw":
            bodyTextarea.placeholder = "Raw text content";
            break;
        }
      }

      function saveRequest() {
        showNotification("Request saved (simulated)", "success");
      }

      function generateCode() {
        const method = document.getElementById("httpMethod").value;
        const url = document.getElementById("apiUrl").value;
        const body = document.getElementById("requestBody").value;

        const code = `// Generated API request code
fetch('${url}', {
    method: '${method}',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify(${body})
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));`;

        navigator.clipboard.writeText(code).then(() => {
          showNotification("Code copied to clipboard!", "success");
        });
      }

      function copyResponse() {
        const response = document.getElementById("responseBody").textContent;
        navigator.clipboard.writeText(response).then(() => {
          showNotification("Response copied to clipboard!", "success");
        });
      }

      function formatResponse() {
        const bodyElem = document.getElementById("responseBody");
        try {
          const json = JSON.parse(bodyElem.textContent);
          bodyElem.innerHTML = JSON.stringify(json, null, 2)
            .replace(/\n/g, "<br>")
            .replace(/ /g, "&nbsp;");
          showNotification("Response formatted", "info");
        } catch {
          showNotification("Invalid JSON", "error");
        }
      }

      // AI Assistant Functions
      function toggleAI() {
        const aiPanel = document.getElementById("aiAssistant");
        aiPanel.classList.toggle("hidden");
      }

      function minimizeAI() {
        const aiPanel = document.getElementById("aiAssistant");
        aiPanel.classList.add("hidden");
      }

      function handleAIInput(event) {
        if (event.key === "Enter") {
          sendAIMessage();
        }
      }

      function sendAIMessage() {
        const input = document.getElementById("aiInput");
        const message = input.value.trim();
        if (message) {
          askAI(message);
          input.value = "";
        }
      }

      async function askAI(question) {
        const chatContainer = document.getElementById("aiChat");

        // Add user message
        const userMessage = document.createElement("div");
        userMessage.className = "flex items-start space-x-2 justify-end";
        userMessage.innerHTML = `
                <div class="bg-blue-600 rounded-lg p-2 text-sm text-white max-w-xs">
                    ${question}
                </div>
                <div class="w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-white text-xs"></i>
                </div>
            `;
        chatContainer.appendChild(userMessage);

        // Add thinking indicator
        const thinkingMessage = document.createElement("div");
        thinkingMessage.className = "flex items-start space-x-2";
        thinkingMessage.innerHTML = `
                <div class="w-6 h-6 rahim-thinking rounded-full flex items-center justify-center">
                    <i class="fas fa-robot text-white text-xs"></i>
                </div>
                <div class="bg-gray-900 rounded-lg p-2 text-sm text-gray-300">
                     Rahim is thinking like a gaming strategist<span class="loading-dots"></span>
                </div>
            `;
        chatContainer.appendChild(thinkingMessage);
        chatContainer.scrollTop = chatContainer.scrollHeight;

        try {
          // Get current code context
          const currentCode = editor ? editor.getValue() : "";
          const fileName = currentFile || "server.js";

          // Create gaming-focused system prompt
          const systemPrompt = `You are Rahim, a gaming-focused Backend Mentor AI assistant. You have a passion for gaming and use gaming terminology and metaphors in your explanations. You specialize in:

- Node.js and Express.js for game backends
- JWT authentication for player systems
- Real-time multiplayer APIs with Socket.io
- Game leaderboards and scoring systems
- Player data management and security
- Performance optimization for gaming
- Database design for games

Always respond with enthusiasm and gaming references. Use emojis and gaming terminology like "level up", "boss fight", "speedrun", "epic", "legendary", etc. Keep responses concise but helpful.

Current context:
- File: ${fileName}
- Project: ${currentProject}
- Code: ${currentCode.substring(0, 1000)}...`;

          const response = await fetch(
            `${GEMINI_API_URL}?key=${GEMINI_API_KEY}`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                contents: [
                  {
                    parts: [
                      {
                        text: `${systemPrompt}\n\nUser question: ${question}`,
                      },
                    ],
                  },
                ],
                generationConfig: {
                  temperature: 0.7,
                  topK: 40,
                  topP: 0.95,
                  maxOutputTokens: 1024,
                },
              }),
            }
          );

          if (!response.ok) {
            throw new Error("API response not OK");
          }

          const data = await response.json();

          // Remove thinking indicator
          thinkingMessage.remove();

          if (
            data.candidates &&
            data.candidates[0] &&
            data.candidates[0].content
          ) {
            const aiResponse = data.candidates[0].content.parts[0].text;

            // Add AI response
            const responseMessage = document.createElement("div");
            responseMessage.className = "flex items-start space-x-2";
            responseMessage.innerHTML = `
                        <div class="w-6 h-6 rahim-avatar rounded-full flex items-center justify-center">
                            <i class="fas fa-robot text-white text-xs"></i>
                        </div>
                        <div class="bg-gray-900 rounded-lg p-2 text-sm text-gray-300 max-w-xs">
                            ${aiResponse.replace(/\n/g, "<br>")}
                        </div>
                    `;
            chatContainer.appendChild(responseMessage);
          } else {
            throw new Error("Invalid response from Gemini API");
          }
        } catch (error) {
          console.error("AI Error:", error);

          // Remove thinking indicator
          thinkingMessage.remove();

          // Add error message with gaming flair
          const errorMessage = document.createElement("div");
          errorMessage.className = "flex items-start space-x-2";
          errorMessage.innerHTML = `
                    <div class="w-6 h-6 rahim-avatar rounded-full flex items-center justify-center">
                        <i class="fas fa-robot text-white text-xs"></i>
                    </div>
                    <div class="bg-red-900 rounded-lg p-2 text-sm text-red-300 max-w-xs">
                         Oops! Looks like I hit a lag spike! The AI servers might be under heavy load. Try again in a moment, or check your API key in settings. Let's get back to coding some epic backends! 
                    </div>
                `;
          chatContainer.appendChild(errorMessage);
        }

        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      function showAISuggestion() {
        const suggestionsPanel = document.getElementById("aiSuggestions");
        suggestionsPanel.classList.remove("hidden");

        // Update suggestion text with gaming flair
        document.getElementById("suggestionText").innerHTML = `
                 Hey! I spotted a potential bug in your JWT verification code! This could be a security vulnerability that hackers might exploit. Let me help you patch this like a pro gamer fixing a speedrun route:
            `;

        document.getElementById("suggestionCode").innerHTML = `
                try {<br>
                &nbsp;&nbsp;const decoded = jwt.verify(token, JWT_SECRET);<br>
                &nbsp;&nbsp;req.user = decoded;<br>
                &nbsp;&nbsp;next();<br>
                } catch (error) {<br>
                &nbsp;&nbsp;return res.status(401).json({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;error: 'Invalid token - Access Denied!'<br>
                &nbsp;&nbsp;});<br>
                }
            `;
      }

      function applySuggestion() {
        if (editor && currentFile) {
          const currentCode = editor.getValue();
          const suggestion = `try {
    const decoded = jwt.verify(token, JWT_SECRET);
    req.user = decoded;
    next();
} catch (error) {
    return res.status(401).json({
        error: 'Invalid token - Access Denied!'
    });
}`;

          // Find and replace the JWT verification part
          const updatedCode = currentCode.replace(
            /\/\/ TODO: Add JWT verification logic here[\s\S]*?next\(\);/,
            suggestion
          );

          editor.setValue(updatedCode);
          dismissSuggestion();
          showNotification(
            " Epic! JWT security patch applied successfully!",
            "success"
          );
          saveState();

          // Update progress
          setTimeout(() => {
            updateProgress(5, 5);
            showNotification(
              " Legendary! All tests passing! You've mastered JWT authentication!",
              "success"
            );
          }, 1000);
        }
      }

      function dismissSuggestion() {
        document.getElementById("aiSuggestions").classList.add("hidden");
      }

      // Settings Functions
      function openSettings() {
        document.getElementById("settingsPanel").classList.remove("hidden");
      }

      function closeSettings() {
        document.getElementById("settingsPanel").classList.add("hidden");
      }

      function changeTheme() {
        const theme = document.getElementById("themeSelect").value;
        document.body.setAttribute("data-theme", theme);
        if (editor) {
          monaco.editor.setTheme(
            theme === "light"
              ? "vs"
              : theme === "high-contrast"
              ? "hc-black"
              : "vs-dark"
          );
        }
        showNotification(` Theme switched to ${theme}!`, "success");
      }

      function changeFontSize() {
        const size = document.getElementById("fontSizeSlider").value;
        document.getElementById("fontSizeValue").textContent = size + "px";
        if (editor) {
          editor.updateOptions({ fontSize: parseInt(size) });
        }
      }

      function toggleAutoSave() {
        isAutoSaveEnabled = document.getElementById("autoSaveToggle").checked;
        const status = isAutoSaveEnabled ? "enabled" : "disabled";
        document.getElementById(
          "autoSaveStatus"
        ).textContent = `Auto-save ${status}`;
        showNotification(` Auto-save ${status}!`, "info");
      }

      function toggleMinimap() {
        const enabled = document.getElementById("minimapToggle").checked;
        if (editor) {
          editor.updateOptions({ minimap: { enabled } });
        }
      }

      function toggleWordWrap() {
        const enabled = document.getElementById("wordWrapToggle").checked;
        if (editor) {
          editor.updateOptions({ wordWrap: enabled ? "on" : "off" });
        }
      }

      function changeTabSize() {
        const size = parseInt(document.getElementById("tabSizeSelect").value);
        if (editor) {
          editor.updateOptions({ tabSize: size });
        }
      }

      // Command Palette
      function showCommandPalette() {
        document.getElementById("commandPalette").classList.remove("hidden");
        document.getElementById("commandInput").focus();
        populateCommands();
      }

      function hideCommandPalette() {
        document.getElementById("commandPalette").classList.add("hidden");
      }

      function populateCommands() {
        const commands = [
          { name: " New Project", action: "showNewProjectModal()" },
          { name: " Save File", action: "saveFile()" },
          { name: " Run Code", action: "runCode()" },
          { name: " Run Tests", action: "runTests()" },
          { name: " Toggle AI Assistant", action: "toggleAI()" },
          { name: " Open Settings", action: "openSettings()" },
          { name: " Find & Replace", action: "showFindWidget()" },
          { name: " Create New File", action: "showCreateFileModal()" },
          { name: " Create New Folder", action: "showCreateFolderModal()" },
          { name: " Format Document", action: "formatDocument()" },
        ];

        const commandList = document.getElementById("commandList");
        commandList.innerHTML = commands
          .map(
            (cmd) =>
              `<div class="p-2 hover:bg-gray-700 cursor-pointer text-sm" onclick="${cmd.action}; hideCommandPalette();">
                    ${cmd.name}
                </div>`
          )
          .join("");
      }

      function filterCommands(event) {
        if (event.key === "Escape") {
          hideCommandPalette();
          return;
        }
        const input = event.target.value.toLowerCase();
        document.querySelectorAll("#commandList div").forEach((item) => {
          if (item.textContent.toLowerCase().includes(input)) {
            item.style.display = "block";
          } else {
            item.style.display = "none";
          }
        });
      }

      // Find & Replace
      function showFindWidget() {
        document.getElementById("findWidget").classList.remove("hidden");
        document.getElementById("findInput").focus();
      }

      function closeFindWidget() {
        document.getElementById("findWidget").classList.add("hidden");
      }

      function findNext() {
        const query = document.getElementById("findInput").value;
        if (editor && query) {
          editor.getAction("actions.find").run();
          editor.trigger("keyboard", "findNext", null);
        }
        showNotification(" Finding next match...", "info");
      }

      function findPrevious() {
        const query = document.getElementById("findInput").value;
        if (editor && query) {
          editor.getAction("actions.find").run();
          editor.trigger("keyboard", "findPrevious", null);
        }
        showNotification(" Finding previous match...", "info");
      }

      function replaceNext() {
        const replace = document.getElementById("replaceInput").value;
        if (editor && replace) {
          editor.getAction("editor.action.replaceOne").run();
        }
        showNotification(" Replaced next match!", "success");
      }

      function replaceAll() {
        const replace = document.getElementById("replaceInput").value;
        if (editor && replace) {
          editor.getAction("editor.action.replaceAll").run();
        }
        showNotification(" Replaced all matches!", "success");
      }

      // Context Menu
      function showContextMenu(x, y) {
        const contextMenu = document.getElementById("contextMenu");
        contextMenu.style.left = x + "px";
        contextMenu.style.top = y + "px";
        contextMenu.classList.remove("hidden");
      }

      function hideContextMenu() {
        document.getElementById("contextMenu").classList.add("hidden");
      }

      function contextAction(action) {
        hideContextMenu();
        switch (action) {
          case "cut":
            document.execCommand("cut");
            showNotification(" Cut to clipboard!", "info");
            break;
          case "copy":
            document.execCommand("copy");
            showNotification(" Copied to clipboard!", "info");
            break;
          case "paste":
            document.execCommand("paste");
            showNotification(" Pasted from clipboard!", "info");
            break;
          case "format":
            formatDocument();
            break;
          case "find":
            showFindWidget();
            break;
        }
      }

      function formatDocument() {
        if (editor) {
          editor.getAction("editor.action.formatDocument").run();
          showNotification(" Document formatted like a pro!", "success");
        }
      }

      // Utility Functions
      function goBack() {
        showNotification(" Going back...", "info");
      }

      function shareSession() {
        const shareUrl = `${window.location.origin}?session=${currentProject}`;
        navigator.clipboard.writeText(shareUrl).then(() => {
          showNotification(
            " Session link copied! Share with your gaming buddies!",
            "success"
          );
        });
      }

      function splitEditor() {
        showNotification(
          " Editor split - double the coding power! (simulated)",
          "info"
        );
      }

      function toggleZenMode() {
        document.body.classList.toggle("zen-mode");
        showNotification(
          " Zen mode toggled - focus like a pro gamer!",
          "info"
        );
      }

      // Resize Functions
      function startResize(event, target) {
        isResizing = true;
        resizeTarget = target;
        event.preventDefault();
      }

      function handleResize(event) {
        if (!isResizing) return;

        const sidebar = document.getElementById("sidebar");
        const rightPanel = document.getElementById("rightPanel");

        if (resizeTarget === "sidebar") {
          const newWidth = Math.max(200, Math.min(500, event.clientX));
          sidebar.style.width = newWidth + "px";
        } else if (resizeTarget === "rightPanel") {
          const newWidth = Math.max(
            300,
            Math.min(600, window.innerWidth - event.clientX)
          );
          rightPanel.style.width = newWidth + "px";
        }
      }

      function stopResize() {
        isResizing = false;
        resizeTarget = null;
      }

      function showFileContextMenu(event, path) {
        event.preventDefault();
        showContextMenu(event.clientX, event.clientY);
      }

      // Initializethe application
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>